/**
 * App version: 1.0.0
 * SDK version: 3.0.0
 * CLI version: 2.0.2
 * 
 * Generated: Tue, 15 Dec 2020 12:16:35 GMT
 */

var APP_accelerator_home_ui=function(){"use strict";const t={},e={};var i={get(e,i,s){const a=((t={},e)=>{const i=e.split(".");for(let e=0;e<i.length;e++)t=t[i[e]]=void 0!==t[i[e]]?t[i[e]]:{};return"object"==typeof t?Object.keys(t).length?t:void 0:t})(t[e],i);return void 0!==a?a:s},has(t,e){return!!this.get(t,e)},set(i,s){t.user[i]=s,((t,i)=>{e[t]&&e[t].forEach((t=>t(i)))})(i,s)},subscribe(t,i){e[t]=e[t]||[],e[t].push(i)},unsubscribe(t,i){if(i){const s=e[t]&&e[t].findIndex((t=>t===i));s>-1&&e[t].splice(s,1)}else t in e&&(e[t]=[])},clearSubscribers(){for(const t of Object.getOwnPropertyNames(e))delete e[t]}};const prepLog=(t,e)=>["%c"+((e=Array.from(e)).length>1&&"string"==typeof e[0]?e.shift():t),"background-color: "+{Info:"green",Debug:"gray",Warn:"orange",Error:"red"}[t]+"; color: white; padding: 2px 4px; border-radius: 2px",e];var s={info(){i.get("platform","log")&&console.log.apply(console,prepLog("Info",arguments))},debug(){i.get("platform","log")&&console.debug.apply(console,prepLog("Debug",arguments))},error(){i.get("platform","log")&&console.error.apply(console,prepLog("Error",arguments))},warn(){i.get("platform","log")&&console.warn.apply(console,prepLog("Warn",arguments))}};let sendMetric=(t,e,i)=>{s.info("Sending metric",t,e,i)};const errorMetric=(t,e,i,s,a={})=>{sendMetric(t,"error",a={params:a,message:e,code:i,visible:s})},Metric=(t,e,i={})=>e.reduce(((e,s)=>(e[s]=(e,a={})=>{a={...i,...e?{name:e}:{},...a},sendMetric(t,s,a)},e)),{error(e,i,s){errorMetric(t,e,i,s)},event(e,i){sendMetric(t,e,i)}});var a,n=(a={app:["launch","loaded","ready","close"],page:["view","leave"],user:["click","input"],media:["abort","canplay","ended","pause","play","volumechange","waiting","seeking","seeked"]},Object.keys(a).reduce(((t,e)=>(t[e]="media"===e?t=>Metric(e,a[e],{url:t}):Metric(e,a[e]),t)),{error:errorMetric,event:sendMetric})),o={abort:"Abort",canplay:"CanPlay",canplaythrough:"CanPlayThrough",durationchange:"DurationChange",emptied:"Emptied",encrypted:"Encrypted",ended:"Ended",error:"Error",interruptbegin:"InterruptBegin",interruptend:"InterruptEnd",loadeddata:"LoadedData",loadedmetadata:"LoadedMetadata",loadstart:"LoadStart",pause:"Pause",play:"Play",playing:"Playing",progress:"Progress",ratechange:"Ratechange",seeked:"Seeked",seeking:"Seeking",stalled:"Stalled",timeupdate:"TimeUpdate",volumechange:"VolumeChange",waiting:"Waiting"};let r=null;let l,h;var c={asset:t=>l+t,proxyUrl:(t,e={})=>h?h+"?"+makeQueryString(t,e):t,makeQueryString(){return makeQueryString(...arguments)},ensureUrlWithProtocol(){return ensureUrlWithProtocol(...arguments)}};const ensureUrlWithProtocol=t=>/^\/\//.test(t)?window.location.protocol+t:/^(?:https?:)/i.test(t)?t:window.location.origin+t,makeFullStaticPath=(t="/",e)=>(e="/"!==e.charAt(e.length-1)?e+"/":e,/^(?:https?:)?(?:\/\/)/.test(e)||"/"===e.charAt(0)?e:(t=cleanUpPathName(t))+(e="/"!==(e="."===e.charAt(0)?e.substr(1):e).charAt(0)?"/"+e:e)),cleanUpPathName=t=>{if("/"===t.slice(-1))return t.slice(0,-1);const e=t.split("/");return e[e.length-1].indexOf(".")>-1&&e.pop(),e.join("/")},makeQueryString=(t,e={},i="url")=>(e.operator="metrological",e[i]=t,Object.keys(e).map((t=>encodeURIComponent(t)+"="+encodeURIComponent(""+e[t]))).join("&")),formatLocale=t=>t&&2===t.length?`${t.toLowerCase()}-${t.toUpperCase()}`:t,getLatLon=t=>new Promise((e=>{new Promise((t=>{!0===i.get("platform","forceBrowserGeolocation")&&t(!0),"permissions"in navigator&&"function"==typeof navigator.permissions.query?navigator.permissions.query({name:"geolocation"}).then((e=>{t("granted"===e.state||"granted"===e.status)})):t(!1)})).then((i=>!0!==i?queryForLatLon().then((i=>e(i||t))):"geolocation"in navigator?void navigator.geolocation.getCurrentPosition((t=>t&&t.coords&&e([t.coords.latitude,t.coords.longitude])),(()=>e(t)),{enableHighAccuracy:!0,timeout:5e3,maximumAge:0}):queryForLatLon().then((i=>e(i||t)))))})),queryForLatLon=()=>new Promise((t=>{fetch("https://geolocation-db.com/json/").then((t=>t.json())).then((({latitude:e,longitude:i})=>t(!(!e||!i)&&[e,i]))).catch((()=>t(!1)))})),d={ageRating:"adult",city:"New York",zipCode:"27505",countryCode:()=>(t=>{if("language"in navigator){const t=formatLocale(navigator.language).slice(3,5);return Promise.resolve(t)}return Promise.resolve(t)})("US"),ip:"127.0.0.1",household:"b2244e9d4c04826ccd5a7b2c2a50e7d4",language:()=>(t=>{if("language"in navigator){const t=formatLocale(navigator.language).slice(0,2);return Promise.resolve(t)}return Promise.resolve(t)})("en"),latlon:()=>getLatLon([40.7128,74.006]),locale:()=>(t=>{if("language"in navigator){const t=formatLocale(navigator.language);return Promise.resolve(t)}return Promise.resolve(t)})("en-US"),mac:"00:00:00:00:00:00",operator:"Metrological",platform:"Metrological",packages:[],uid:"ee6723b8-7ab3-462c-8d93-dbf61227998e",stbType:"Metrological"};let getInfo=t=>{const e={...d,...i.get("platform","profile")};return Promise.resolve("function"==typeof e[t]?e[t]():e[t])},setInfo=(t,e)=>{t in d&&(d[t]=e)};var g=window.lng;let mediaUrl=t=>t;g.Component;class localCookie{constructor(t){return t=t||{},this.forceCookies=t.forceCookies||!1,!0===this._checkIfLocalStorageWorks()&&!0!==t.forceCookies?{getItem:this._getItemLocalStorage,setItem:this._setItemLocalStorage,removeItem:this._removeItemLocalStorage,clear:this._clearLocalStorage}:{getItem:this._getItemCookie,setItem:this._setItemCookie,removeItem:this._removeItemCookie,clear:this._clearCookies}}_checkIfLocalStorageWorks(){if("undefined"==typeof localStorage)return!1;try{return localStorage.setItem("feature_test","yes"),"yes"===localStorage.getItem("feature_test")&&(localStorage.removeItem("feature_test"),!0)}catch(t){return!1}}_getItemLocalStorage(t){return window.localStorage.getItem(t)}_setItemLocalStorage(t,e){return window.localStorage.setItem(t,e)}_removeItemLocalStorage(t){return window.localStorage.removeItem(t)}_clearLocalStorage(){return window.localStorage.clear()}_getItemCookie(t){var e=document.cookie.match(RegExp("(?:^|;\\s*)"+function(t){return t.replace(/([.*+?\^${}()|\[\]\/\\])/g,"\\$1")}(t)+"=([^;]*)"));return e&&""===e[1]&&(e[1]=null),e?e[1]:null}_setItemCookie(t,e){document.cookie=`${t}=${e}`}_removeItemCookie(t){document.cookie=t+"=;Max-Age=-99999999;"}_clearCookies(){document.cookie.split(";").forEach((t=>{document.cookie=t.replace(/^ +/,"").replace(/=.*/,"=;expires=Max-Age=-99999999")}))}}let p,u;const isFunction=t=>"function"==typeof t,isObject=t=>"object"==typeof t&&null!==t,isBoolean=t=>"boolean"==typeof t,isPage=t=>!!(t instanceof g.Element||isComponentConstructor(t)),isComponentConstructor=t=>t.prototype&&"isComponent"in t.prototype,isArray=t=>Array.isArray(t),ucfirst=t=>`${t.charAt(0).toUpperCase()}${t.slice(1)}`,isString=t=>"string"==typeof t,isPromise=(t,e)=>{let i;if(isFunction(t))try{i=t.apply(null)}catch(t){i=t}else i=t;return isObject(i)&&isFunction(i.then)},m={route:Symbol("route"),hash:Symbol("hash"),store:Symbol("store"),fromHistory:Symbol("fromHistory"),expires:Symbol("expires"),resume:Symbol("resume"),backtrack:Symbol("backtrack")},moveOnAxes=(t,e,i,s)=>{const a="x"===t?1920:1080;return new Promise((n=>{i.patch({[""+t]:e?-1*a:a,visible:!0,smooth:{[""+t]:[0,{duration:.4,delay:.2}]}}),s&&s.patch({[""+t]:0,smooth:{[""+t]:[e?a:-1*a,{duration:.4,delay:.2}]}}),i.transition(t).on("finish",(()=>{n()}))}))};var y={fade:(t,e)=>new Promise((i=>{t.patch({alpha:0,visible:!0,smooth:{alpha:[1,{duration:.5,delay:.1}]}}),t.transition("alpha").on("finish",(()=>{e&&(e.visible=!1),i()}))})),crossFade:(t,e)=>new Promise((i=>{t.patch({alpha:0,visible:!0,smooth:{alpha:[1,{duration:.5,delay:.1}]}}),e&&e.patch({smooth:{alpha:[0,{duration:.5,delay:.3}]}}),t.transition("alpha").on("finish",(()=>{i()}))})),up:(t,e)=>moveOnAxes("y",0,t,e),down:(t,e)=>moveOnAxes("y",1,t,e),left:(t,e)=>moveOnAxes("x",0,t,e),right:(t,e)=>moveOnAxes("x",1,t,e)},f=function isMergeableObject(t){return function isNonNullObject(t){return!!t&&"object"==typeof t}(t)&&!function isSpecial(t){var e=Object.prototype.toString.call(t);return"[object RegExp]"===e||"[object Date]"===e||function isReactElement(t){return t.$$typeof===v}(t)}(t)};var v="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function cloneUnlessOtherwiseSpecified(t,e){return!1!==e.clone&&e.isMergeableObject(t)?deepmerge(function emptyTarget(t){return Array.isArray(t)?[]:{}}(t),t,e):t}function defaultArrayMerge(t,e,i){return t.concat(e).map((function(t){return cloneUnlessOtherwiseSpecified(t,i)}))}function getKeys(t){return Object.keys(t).concat(function getEnumerableOwnPropertySymbols(t){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(t).filter((function(e){return t.propertyIsEnumerable(e)})):[]}(t))}function propertyIsOnObject(t,e){try{return e in t}catch(t){return!1}}function mergeObject(t,e,i){var s={};return i.isMergeableObject(t)&&getKeys(t).forEach((function(e){s[e]=cloneUnlessOtherwiseSpecified(t[e],i)})),getKeys(e).forEach((function(a){(function propertyIsUnsafe(t,e){return propertyIsOnObject(t,e)&&!(Object.hasOwnProperty.call(t,e)&&Object.propertyIsEnumerable.call(t,e))})(t,a)||(propertyIsOnObject(t,a)&&i.isMergeableObject(e[a])?s[a]=function getMergeFunction(t,e){if(!e.customMerge)return deepmerge;var i=e.customMerge(t);return"function"==typeof i?i:deepmerge}(a,i)(t[a],e[a],i):s[a]=cloneUnlessOtherwiseSpecified(e[a],i))})),s}function deepmerge(t,e,i){(i=i||{}).arrayMerge=i.arrayMerge||defaultArrayMerge,i.isMergeableObject=i.isMergeableObject||f,i.cloneUnlessOtherwiseSpecified=cloneUnlessOtherwiseSpecified;var s=Array.isArray(e);return s===Array.isArray(t)?s?i.arrayMerge(t,e,i):mergeObject(t,e,i):cloneUnlessOtherwiseSpecified(e,i)}deepmerge.all=function deepmergeAll(t,e){if(!Array.isArray(t))throw new Error("first argument should be an array");return t.reduce((function(t,i){return deepmerge(t,i,e)}),{})};var _=deepmerge;let S=!1;const deprecated=(t=!1)=>{!0!==t&&!1!==S||console.warn("The 'Locale'-plugin in the Lightning-SDK is deprecated and will be removed in future releases. \n\n Please consider using the new 'Language'-plugin instead."),S=!0};class LocalizedString extends String{format(...t){const e=t.reduce(((t,e,i)=>t.split(`{${i}}`).join(e)),this);return new LocalizedString(e)}}var x=new class Locale{constructor(){this.__enabled=!1}async load(t){this.__enabled&&await fetch(t).then((t=>t.json())).then((t=>{this.loadFromObject(t)}))}setLanguage(t){deprecated(),this.__enabled=!0,this.language=t}get tr(){return deprecated(!0),this.__trObj[this.language]}loadFromObject(t){deprecated();const e="en";if(-1===Object.keys(t).indexOf(this.language)){if(s.warn("No translations found for: "+this.language),!(Object.keys(t).indexOf(e)>-1)){const t="No translations found for fallback language: en";throw s.error(t),Error(t)}s.warn("Using fallback language: en"),this.language=e}this.__trObj=t;for(const t of Object.values(this.__trObj))for(const e of Object.keys(t))t[e]=new LocalizedString(t[e])}};class VersionLabel extends g.Component{static _template(){return{rect:!0,color:3137370284,h:40,w:100,x:t=>t-50,y:t=>t-50,mount:1,Text:{w:t=>t,h:t=>t,y:5,x:20,text:{fontSize:22,lineHeight:26}}}}_firstActive(){this.tag("Text").text=`APP - v${this.version}\nSDK - v${this.sdkVersion}`,this.tag("Text").loadTexture(),this.w=this.tag("Text").renderWidth+40,this.h=this.tag("Text").renderHeight+5}}class FpsIndicator extends g.Component{static _template(){return{rect:!0,color:4294967295,texture:g.Tools.getRoundRect(80,80,40),h:80,w:80,x:100,y:100,mount:1,Background:{x:3,y:3,texture:g.Tools.getRoundRect(72,72,36),color:4278222848},Counter:{w:t=>t,h:t=>t,y:10,text:{fontSize:32,textAlign:"center"}},Text:{w:t=>t,h:t=>t,y:48,text:{fontSize:15,textAlign:"center",text:"FPS"}}}}_setup(){this.config={log:!1,interval:500,threshold:1,...i.get("platform","showFps")},this.fps=0,this.lastFps=this.fps-this.config.threshold;const fpsCalculator=()=>{this.fps=~~(1/this.stage.dt)};this.stage.on("frameStart",fpsCalculator),this.stage.off("framestart",fpsCalculator),this.interval=setInterval(this.showFps.bind(this),this.config.interval)}_firstActive(){this.showFps()}_detach(){clearInterval(this.interval)}showFps(){if(Math.abs(this.lastFps-this.fps)<=this.config.threshold)return;this.lastFps=this.fps;let t=4278222848;this.fps<=40&&this.fps>20?t=4294944e3:this.fps<=20&&(t=4294901760),this.tag("Background").setSmooth("color",t),this.tag("Counter").text=""+this.fps,this.config.log&&s.info("FPS",this.fps)}}let w={},b={},P=null;const setTranslations=t=>{"meta"in t&&(w={...t.meta},delete t.meta),b=t},setLanguage=t=>(P=null,new Promise(((e,i)=>{if(t in b)P=t;else if("map"in w&&t in w.map&&w.map[t]in b)P=w.map[t];else if("default"in w&&w.default in b){P=w.default;const t="Translations for Language "+P+" not found. Using default language "+w.default;s.warn(t),i(t)}else{const t="Translations for Language "+P+" not found.";s.error(t),i(t)}if(P){s.info("Setting language to",P);const t=b[P];if("object"==typeof t)e();else if("string"==typeof t){const a=c.asset(t);fetch(a).then((t=>t.json())).then((t=>{b[P]=t,e()})).catch((t=>{const e="Error while fetching "+a;s.error(e,t),i(e)}))}}}))),T={eventListeners:[],timeouts:[],intervals:[],targets:[]};var I={setTimeout(t,e,...i){const a=setTimeout((()=>{T.timeouts=T.timeouts.filter((t=>t!==a)),t.apply(null,i)}),e,i);return s.info("Set Timeout","ID: "+a),T.timeouts.push(a),a},clearTimeout(t){T.timeouts.indexOf(t)>-1?(T.timeouts=T.timeouts.filter((e=>e!==t)),s.info("Clear Timeout","ID: "+t),clearTimeout(t)):s.error("Clear Timeout","ID "+t+" not found")},clearTimeouts(){T.timeouts.forEach((t=>{this.clearTimeout(t)}))},setInterval(t,e,...i){const a=setInterval((()=>{T.intervals=T.intervals.filter((t=>t!==a)),t.apply(null,i)}),e,i);return s.info("Set Interval","ID: "+a),T.intervals.push(a),a},clearInterval(t){T.intervals.indexOf(t)>-1?(T.intervals=T.intervals.filter((e=>e!==t)),s.info("Clear Interval","ID: "+t),clearInterval(t)):s.error("Clear Interval","ID "+t+" not found")},clearIntervals(){T.intervals.forEach((t=>{this.clearInterval(t)}))},addEventListener(t,e,i){t.addEventListener(e,i);let a=T.targets.indexOf(t)>-1?T.targets.indexOf(t):T.targets.push(t)-1;T.eventListeners[a]=T.eventListeners[a]||{},T.eventListeners[a][e]=T.eventListeners[a][e]||[],T.eventListeners[a][e].push(i),s.info("Add eventListener","Target:",t,"Event: "+e,"Handler:",i)},removeEventListener(t,e,i){const a=T.targets.indexOf(t);a>-1&&T.eventListeners[a]&&T.eventListeners[a][e]&&T.eventListeners[a][e].indexOf(i)>-1?(T.eventListeners[a][e]=T.eventListeners[a][e].filter((t=>t!==i)),s.info("Remove eventListener","Target:",t,"Event: "+e,"Handler:",i),t.removeEventListener(e,i)):s.error("Remove eventListener","Not found","Target",t,"Event: "+e,"Handler",i)},removeEventListeners(t,e){if(t&&e){const i=T.targets.indexOf(t);i>-1&&T.eventListeners[i][e].forEach((i=>{this.removeEventListener(t,e,i)}))}else if(t){const e=T.targets.indexOf(t);e>-1&&Object.keys(T.eventListeners[e]).forEach((e=>{this.removeEventListeners(t,e)}))}else Object.keys(T.eventListeners).forEach((t=>{this.removeEventListeners(T.targets[t])}))},clear(){this.clearTimeouts(),this.clearIntervals(),this.removeEventListeners(),T.eventListeners=[],T.timeouts=[],T.intervals=[],T.targets=[]}},k="3.0.0";let C;const A={stage:{w:1920,h:1080,clearColor:0,canvas2d:!1},debug:!1,defaultFontFace:"RobotoRegular",keys:{8:"Back",13:"Enter",27:"Menu",37:"Left",38:"Up",39:"Right",40:"Down",174:"ChannelDown",175:"ChannelUp",178:"Stop",250:"PlayPause",191:"Search",409:"Search"}};function Application(t,e,a){return class Application extends g.Application{constructor(t){const e=_(A,t);super(e),this.config=e}static _template(){return{w:1920,h:1080}}_setup(){Promise.all([this.loadFonts(t.config&&t.config.fonts||t.getFonts&&t.getFonts()||[]),x.load(t.config&&t.config.locale||t.getLocale&&t.getLocale()),t.language&&this.loadLanguage(t.language())]).then((()=>{n.app.loaded(),C=this.stage.c({ref:"App",type:t,zIndex:1,forceZIndexContext:!!a.showVersion||!!a.showFps}),this.childList.a(C),s.info("App version",this.config.version),s.info("SDK version",k),a.showVersion&&this.childList.a({ref:"VersionLabel",type:VersionLabel,version:this.config.version,sdkVersion:k,zIndex:1}),a.showFps&&this.childList.a({ref:"FpsCounter",type:FpsIndicator,zIndex:1}),super._setup()})).catch(console.error)}_handleBack(){this.closeApp()}_handleExit(){this.closeApp()}closeApp(){s.info("Closing App"),i.clearSubscribers(),I.clear(),a.onClose&&"function"==typeof a.onClose?a.onClose():this.close()}close(){s.info("Closing App"),this.childList.remove(this.tag("App")),this.stage.gc(),this.destroy()}loadFonts(t){return new Promise(((e,i)=>{t.map((({family:t,url:e,descriptors:i})=>()=>{const s=new FontFace(t,"url("+e+")",i||{});return document.fonts.add(s),s.load()})).reduce(((t,e)=>t.then((()=>e()))),Promise.resolve(null)).then(e).catch(i)}))}loadLanguage(t){let e=c.asset("translations.json"),i=null;return"object"==typeof t&&("file"in t||"language"in t)?(i=t.language||null,e=t.file&&t.file):i=t,((t,e=null)=>new Promise(((i,a)=>{fetch(t).then((t=>t.json())).then((t=>{setTranslations(t),"object"==typeof e&&"then"in e&&"function"==typeof e.then?e.then((t=>setLanguage(t).then(i).catch(a))).catch((t=>{s.error(t),a(t)})):setLanguage(e).then(i).catch(a)})).catch((()=>{const e="Language file "+t+" not found";s.error(e),a(e)}))})))(e,i)}set focus(t){this._focussed=t,this._refocus()}_getFocused(){return this._focussed||this.tag("App")}}}720===window.innerHeight&&(A.stage.w=1280,A.stage.h=720,A.stage.precision=.6666666667);class RoutedApp extends g.Component{static _template(){return{Pages:{forceZIndexContext:!0},Loading:{rect:!0,w:1920,h:1080,color:4278190080,visible:!1,zIndex:99,Label:{mount:.5,x:960,y:540,text:{text:"Loading.."}}}}}static _states(){return[class Loading extends(this){$enter(){this.tag("Loading").visible=!0}$exit(){this.tag("Loading").visible=!1}},class Widgets extends(this){$enter(t,e){this._widget=e,this._refocus()}_getFocused(){return this._widget}reload(t){this._widget=t,this._refocus()}_handleKey(){restore()}}]}get pages(){return this.tag("Pages")}get widgets(){return this.tag("Widgets")}_handleBack(){}_captureKey(){}_getFocused(){return getActivePage()}}const L=new Map,E=new Map,D=new Map,R=new Map,N=new Map,move=(t,e,i)=>{if(N.has(t)){const s=N.get(t),a=s.route;if(s.hash=t,isObject(i)&&Object.keys(i).forEach((t=>{s[t]=i[t]})),e.has(a)){const t=e.get(a);t.push(s),e.set(a,t)}else e.set(a,[s]);N.delete(t)}},F={ready:t=>{if(L.has(t)){const e=L.get(t);e.ready=Date.now(),N.set(t,e),L.delete(t)}},stop:t=>{move(t,E,{stop:Date.now()})},error:t=>{move(t,R,{error:Date.now()})},expired:t=>{move(t,D,{expired:Date.now})}};var stats_send=(t,e,s)=>{if(i.get("platform","stats")){if(e||s){if(L.has(t)&&e&&s){L.get(t)[e]=s}}else L.has(t)||L.set(t,{start:Date.now()});if(e&&F[e]){const i=F[e];i&&i.call(null,t)}}};let getHash=()=>document.location.hash,setHash=t=>{document.location.hash=t};let O,M,B,V,j;const U=new Map,z=new Map,$=new Map,K=new Map;let W,H,J,Y,X,q,Q,G,Z,tt=new Map,et=[],it=!1,st=!0,at=!0;const nt=/\{\/(.*?)\/([igm]{0,3})\}/g,ot=/^[!*$]$/,setupRoutes=t=>{let e=t.bootComponent;it||(J=t.root,isFunction(t.boot)&&boot(t.boot),e&&isPage(e)&&route("@boot-page",t.bootComponent),isBoolean(t.updateHash)&&(st=t.updateHash),it=!0),t.routes.forEach((t=>{route(t.path,t.component||t.hook,t.options),t.widgets&&widget(t.path,t.widgets),isFunction(t.on)&&on(t.path,t.on,t.cache||0),isFunction(t.before)&&before(t.path,t.before,t.cache||0),isFunction(t.after)&&after(t.path,t.after,t.cache||0)}))},route=(t,e,i)=>{if(t=t.replace(/\/+$/,""),U.has(t)){let i=U.get(t);isArray(i)||(i=[i]);i.filter((t=>isPage(t))).length?isFunction(e)&&!isPage(e)?i.push(e):console.warn(`Page for route('${t}') already exists`):(isFunction(e)||W.get("lazyCreate")||(e=isComponentConstructor(e)?create(e):e,j.a(e)),i.push(e)),U.set(t,i)}else isPage(e)&&(W.get("lazyCreate")||(e=isComponentConstructor(e)?create(e):e,j.a(e))),U.set(t,[e]),i&&$.set(t,i)},widget=(t,e=[])=>{K.has(t)?console.warn("Widgets already exist for "+t):(isArray(e)||(e=[e]),K.set(t,e))},create=t=>{const e=B.c({type:t,visible:!1});return V&&(e.widgets=getWidgetReferences()),e},load=async({route:t,hash:e})=>{let i=!1;const a=new Map(tt);try{const n=await loader({hash:e,route:t,routeReg:a});if(n&&n.hash===at){if("Loading"===M.state&&("Widgets"===G?M._setState("Widgets",[H]):M._setState("")),n.share)return n;await doTransition(n.page,Z)}else i=!0;if(!i)return onRouteFulfilled(n,a),n.page;s.debug("[router]:",`Rejected ${n.hash} because route to ${at} started`),n.create&&!n.share&&j.remove(n.page)}catch(t){i||(t.create&&!t.share&&j.remove(t.page),handleError(t))}},loader=async({route:t,hash:e,routeReg:i})=>{let s=getPageByRoute(t),a=isComponentConstructor(s),n=!1,o=!1,r=null,l=!1;if(a||i.get(m.backtrack)||mustReuse(t)||(s=s.constructor,a=!0),a)r=create(s),j.a(r),z.has(t)&&(o=!0),l=!0;else{r=s,z.has(t)&&(isPageExpired(s)||s[m.hash]!==e)&&(o=!0),t===(Z&&Z[m.route])&&(n=!0)}r[m.hash]=e,r[m.route]=t;const h={page:r,route:t,hash:e,register:i,create:l,share:n,event:[l?"mounted":"changed"]};try{if(o){const{type:i}=z.get(t);return h.loadType=i,send$1(e,i+"-start",Date.now()),await rt[n?"shared":i](h),send$1(e,i+"-end",Date.now()),e===at&&(emit(r,"dataProvided"),h)}return addPersistData(h),h}catch(t){return h.error=t,Promise.reject(h)}},onRouteFulfilled=({page:t,route:e,event:i,hash:a,share:n},o)=>{hashmod(a,"clearHistory")?et.length=0:q&&!ot.test(e)&&updateHistory(q);const r=getPageStackLocation(e);if(!isNaN(r)){let i=U.get(e);i[r]=t,U.set(e,i)}i&&emit(t,i),V&&updateWidgets(t),M._refocus(),Z&&!n&&cleanUp(Z,Z[m.route],o),send$1(a,"ready"),Z=t,X=e,q=a,s.info("[route]:",e),s.info("[hash]:",a)},rt={on:t=>(G=M.state||"",M._setState("Loading"),execProvider(t)),after:t=>{try{execProvider(t)}catch(t){}return Promise.resolve()},before:t=>execProvider(t),shared:t=>execProvider(t)},emit=(t,e=[],i={})=>{isArray(e)||(e=[e]),e.forEach((e=>{const s="_on"+ucfirst(e);isFunction(t[s])&&t[s](i)}))},send$1=(t,e,i)=>{stats_send(t,e,i)},handleError=t=>{if(t.page){const e=t.page[m.hash];send$1(e,"e",t.error),t.page[m.expires]=Date.now(),U.has("!")?load({route:"!",hash:e}).then((e=>{e.error={page:t.page,error:t.error},"Loading"===M.state&&M._setState(""),Z!==e&&(Z=e,M._refocus())})):s.error(t.page,t.error)}else console.error(t)},updateHistory=t=>{const e=getMod(t,"store"),i=tt.get(m.store);let s=hashmod(t,"preventStorage"),a=!0;if((isBoolean(e)&&!1===e||s)&&(a=!1),i&&a){const e=t.replace(/^\//,""),i=et.indexOf(e);-1===i||W.get("storeSameHash")?et.push(e):et.push(et.splice(i,1)[0])}},mustReuse=t=>{const e=routemod(t,"reuseInstance"),i=W.get("reuseInstance");return isBoolean(e)?e:!(isBoolean(i)&&!1===i)},boot=t=>{Y=t},addPersistData=({page:t,route:e,hash:i,register:s=new Map})=>{const a=getValuesFromHash(i,e),n=new Map([...a,...s]),o={};for(let[e,i]of n)t[e]=i,o[e]=i;if(s.size){const e={};for(let[t,i]of s)e[t]=i;t.persist=e}return t.params=o,emit(t,["urlParams"],o),o},execProvider=t=>{const{cb:e,expires:i}=z.get(t.route),s=addPersistData(t);return((t,e)=>!!/^\w*?\s?\(\s?\{.*?\}\s?\)/i.test(t.toString())&&(console.warn([`DEPRECATION: The data-provider for route: ${e} is not correct.`,'"page" is no longer a property of the params object but is now the first function parameter: ',"https://github.com/rdkcentral/Lightning-SDK/blob/feature/router/docs/plugins/router/dataproviding.md#data-providing","It's supported for now but will be removed in a future release."].join("\n")),!0))(e,t.route)?e({page:t.page,...s}).then((()=>{t.page[m.expires]=Date.now()+i})):e(t.page,{...s}).then((()=>{t.page[m.expires]=Date.now()+i}))},doTransition=(t,e=null)=>{let i=t.pageTransition||t.easing;const s=!!(t.smoothIn||t.smoothInOut||i),a=W.get("disableTransitions");if(t.easing&&console.warn("easing() method is deprecated and will be removed. Use pageTransition()"),!s||a)return t.visible=!0,e&&(e.visible=!1),Promise.resolve();if(i){let s;try{s=i.call(t,t,e)}catch(t){s="crossFade"}if(isPromise(s))return s;if(isString(s)){const i=y[s];if(i)return i(t,e)}if(t.smoothIn){const smooth=(e,i,s={})=>new Promise((a=>{t.visible=!0,t.setSmooth(e,i,s),t.transition(e).on("finish",(()=>{a()}))}));return t.smoothIn({pageIn:t,smooth:smooth})}}return y.crossFade(t,e)},updateWidgets=t=>{const e=t[m.route],i=(K.get(e)||[]).map((t=>t.toLowerCase()));V.forEach((e=>{e.visible=-1!==i.indexOf(e.ref.toLowerCase()),e.visible&&emit(e,["activated"],t)})),"Widgets"===M.state&&H&&!H.visible&&M._setState("")},cleanUp=(t,e,i)=>{const s=W.get("lazyDestroy"),a=W.get("destroyOnHistoryBack"),n=read("keepAlive",i);let o=!1;if((read(m.backtrack,i)&&(a||s)||s&&!n)&&(o=!0),o){const i=U.get(e);i[getPageStackLocation(e)]=t._routedType||t.constructor,U.set(e,i),j.remove(t),W.get("gcOnUnload")&&B.gc()}else t.patch({x:0,y:0,scale:1,alpha:1,visible:!1});send$1(t[m.hash],"stop")},isPageExpired=t=>{if(!t[m.expires])return!1;const e=t[m.expires];return Date.now()>=e},getPageByRoute=t=>getPageFromStack(t).item,getPageStackLocation=t=>getPageFromStack(t).index,getPageFromStack=t=>{if(!U.has(t))return!1;let e=-1,i=null,s=U.get(t);Array.isArray(s)||(s=[s]);for(let t=0,a=s.length;t<a;t++)if(isPage(s[t])){e=t,i=s[t];break}return{index:e,item:i}},getFloor=t=>stripRegex(t).split("/").length,stripRegex=(t,e="R")=>(nt.test(t)&&(t=t.replace(nt,e)),t),getRouteByHash=t=>{const e=/(\/?:?[@\w%\s-]+)/g,i=(t=>{const e=[];for(let[i]of U.entries())getFloor(i)===t&&e.push(i);return e})(getFloor(t)),s=t.match(e)||[],a=/\/:\w+?@@([0-9]+?)@@/,n=/^\/:/;let o=[],r=i.filter((t=>{let i=!0;if(ot.test(t))return!1;if(nt.test(t)){const e=t.match(nt);e&&e.length&&(t=e.reduce(((t,e)=>{const i=o.length;return t=t.replace(e,`@@${i}@@`),o.push(e.substring(1,e.length-1)),t}),t))}const r=t.match(e)||[];for(let t=0,e=r.length;t<e;t++){const e=r[t],l=s[t];if(a.test(e)){const t=a.exec(e)[1],s=o[t],n=/\/([^\/]+)\/([igm]{0,3})/.exec(s);if(n&&n.length){const t=n[1],e=n[2];new RegExp(`^/${t}$`,e).test(l)||(i=!1)}}else{if(n.test(e))continue;l&&e.toLowerCase()!==l.toLowerCase()&&(i=!1)}}return i}));return!!r.length&&(r=r.sort((t=>n.test(t)?-1:1)),r[0])},getValuesFromHash=(t,e)=>{e=stripRegex(e,"");const i=/(\/?:?[\w%\s-]+)/g,s=t.match(i)||[],a=e.match(i)||[],n=/^\/:([\w-]+)\/?/;return a.reduce(((t,e,i)=>{const a=n.exec(e);return a&&a.length&&t.set(a[1],decodeURIComponent(s[i].replace(/^\//,""))),t}),new Map)},handleHashChange=t=>{const e=t||getHash(),i=getRouteByHash(e);if(send$1(e),at=e,i){if(U.has(i)){let t=U.get(i);send$1(e,"route",i),isArray(t)||(t=[t]),t.forEach(((t,s,a)=>{if(isPage(t))load({route:i,hash:e}).then((()=>{M._refocus()}));else if(isPromise(t))t().then((t=>t.default)).then((t=>(a[s]=t,load({route:i,hash:e})))).then((()=>{M._refocus()}));else{const s=getValuesFromHash(e,i),a={};for(const t of s.keys())a[t]=s.get(t);t.call(null,M,{...a})}}))}}else U.has("*")&&load({route:"*",hash:e}).then((()=>{M._refocus()}))},getMod=(t,e)=>{const i=$.get(getRouteByHash(t));if(isObject(i))return i[e]},hashmod=(t,e)=>routemod(getRouteByHash(t),e),routemod=(t,e)=>{if($.has(t)){return $.get(t)[e]}},read=(t,e)=>!!e.has(t)&&e.get(t),navigate=(t,e,i=!0)=>{let s=getHash();tt.clear(),!mustUpdateHash()&&Q&&(s=Q),isObject(e)?tt=(t=>{const e=new Map;return[...Object.keys(t),...Object.getOwnPropertySymbols(t)].forEach((i=>{e.set(i,t[i])})),e})(e):isBoolean(e)&&!e&&(i=e),tt.set(m.store,i),s.replace(/^#/,"")!==t?mustUpdateHash()?setHash(t):(Q=t,handleHashChange(t)):read("reload",tt)&&handleHashChange(s)},step=(t=0)=>{if(!t)return!1;if(et.length){const t=et.splice(et.length-1,1);return navigate(t[0],{[m.backtrack]:!0},!1)}if(W.get("backtrack")){const t=/(\/:?[\w%\s-]+)$/;let e=stripRegex(getHash()),i=getFloor(e);if(i>1)for(;i--;)if(e=e.replace(t,""),getRouteByHash(e))return navigate(e,{[m.backtrack]:!0},!1)}return!!isFunction(M._handleAppClose)&&M._handleAppClose()},capture=({key:t})=>{if("Loading"!==M.state){if(!W.get("numberNavigation"))return!1;if(t=parseInt(t),!isNaN(t)){let e,i=1;for(let s of U.keys()){if(i===t){e=s;break}i++}e&&navigate(e)}return!1}},start=()=>{const t=U.has("@boot-page"),e=getHash(),i=(t=>{const e=/([?&].*)/.exec(t),i={};if(e&&e.length){const t=new URLSearchParams(e[1]);for(const[e,s]of t.entries())i[e]=s;return i}return!1})(e),s=-1!==e.indexOf("@boot-page"),ready=()=>{t?navigate("@boot-page",{[m.resume]:s?J:e||J,reload:!0}):!e&&J?isString(J)?navigate(J):isFunction(J)&&J().then((t=>{navigate(t)})):handleHashChange()};isFunction(Y)?Y(i).then((()=>{ready()})):ready()},on=(t,e,i=0,s="on")=>{z.has(t)?console.warn(`provider for ${t} already exists`):z.set(t,{cb:e,expires:1e3*i,type:s})},before=(t,e,i=0)=>{on(t,e,i,"before")},after=(t,e,i=0)=>{on(t,e,i,"after")},getWidgetReferences=()=>V.get().reduce(((t,e)=>(t[e.ref.toLowerCase()]=e,t)),{}),focusWidget=t=>{const e=(t=>(t=ucfirst(t),V.getByRef(t)||!1))(t);t&&(H=e,"Widgets"===M.state?M.reload(H):M._setState("Widgets",[H]))},handleRemote=(t,e)=>{"widget"===t?focusWidget(e):"page"===t&&restoreFocus()},restore=()=>{W.get("autoRestoreRemote")&&handleRemote("page")},mustUpdateHash=()=>{const t=W.get("updateHash");return!(isBoolean(t)&&!t||isBoolean(st)&&!st)},restoreFocus=()=>{H=null,M._setState("")},getActivePage=()=>Z&&Z.attached?Z:M;window.addEventListener("hashchange",(()=>{handleHashChange()}));var Router_startRouter=(t,e)=>{let{appInstance:s,routes:a,provider:n=(()=>{}),widgets:o=(()=>{})}=t;e&&isPage(e)&&(M=e),M||(M=s||C),O=M.application,j=O.childList,B=M.stage,W=(()=>{const t=i.get("platform","router"),e=isObject(t);return["backtrack","gcOnUnload","destroyOnHistoryBack","lazyCreate","lazyDestroy","reuseInstance","autoRestoreRemote","numberNavigation","updateHash"].reduce(((s,a)=>(s.set(a,e?t[a]:i.get("platform",a)),s)),new Map)})(),M.pages&&(j=M.pages.childList),M.widgets&&M.widgets.children&&(V=M.widgets.childList,V.forEach((t=>t.visible=!1))),M._handleBack=t=>{step(-1),t.preventDefault()},M._captureKey=capture.bind(null),isArray(a)?(setupRoutes(t),start()):isFunction(a)&&(n(),a(),o())},lt=navigate,ht=RoutedApp;const ct=[{number:1,name:"Metro News 1",description:"New York Cable News Channel",entitled:!0,program:{title:"The Morning Show",description:"New York's best morning show",startTime:new Date(new Date-3e5).toUTCString(),duration:1800,ageRating:0}},{number:2,name:"MTV",description:"Music Television",entitled:!0,program:{title:"Beavis and Butthead",description:"American adult animated sitcom created by Mike Judge",startTime:new Date(new Date-12e5).toUTCString(),duration:2700,ageRating:18}},{number:3,name:"NBC",description:"NBC TV Network",entitled:!1,program:{title:"The Tonight Show Starring Jimmy Fallon",description:"Late-night talk show hosted by Jimmy Fallon on NBC",startTime:new Date(new Date-6e5).toUTCString(),duration:3600,ageRating:10}}],channels=()=>i.get("platform","tv",ct),randomChannel=()=>channels()[~~(channels.length*Math.random())];let dt;const gt={},emit$1=(t,...e)=>{gt[t]&&gt[t].forEach((t=>{t.apply(null,e)}))};let pt={getChannel:()=>(dt||(dt=randomChannel()),new Promise(((t,e)=>{if(dt){const e={...dt};delete e.program,t(e)}else e("No channel found")}))),getProgram:()=>(dt||(dt=randomChannel()),new Promise(((t,e)=>{dt.program?t(dt.program):e("No program found")}))),setChannel:t=>new Promise(((e,i)=>{if(t){const s=channels().find((e=>e.number===t));if(s){dt=s;const t={...dt};delete t.program,emit$1("channelChange",t),e(t)}else i("Channel not found")}else i("No channel number supplied")}))};let ut;var Launch=(e,s,a,n)=>{((e,i)=>{t.app=e,t.platform=i,t.user={}})(s,a),(t=>{l=ensureUrlWithProtocol(makeFullStaticPath(window.location.pathname,t.path||"/")),t.proxyUrl&&(h=ensureUrlWithProtocol(t.proxyUrl))})(a),p=i.get("platform","appId"),u=new localCookie,a.plugins&&(a.plugins.profile&&(t=>{t.getInfo,t.setInfo})(a.plugins.profile),a.plugins.metrics&&(t=>{sendMetric=t.sendMetric})(a.plugins.metrics),a.plugins.mediaPlayer&&(t=>{t.mediaUrl&&(mediaUrl=t.mediaUrl)})(a.plugins.mediaPlayer),a.plugins.mediaPlayer&&initVideoPlayer(a.plugins.mediaPlayer),a.plugins.ads&&initAds(a.plugins.ads),a.plugins.router&&(t=>{t.getHash&&(getHash=t.getHash),t.setHash&&(setHash=t.setHash)})(a.plugins.router),a.plugins.tv&&(t=>{pt={},t.getChannel&&"function"==typeof t.getChannel&&(pt.getChannel=t.getChannel),t.getProgram&&"function"==typeof t.getProgram&&(pt.getProgram=t.getProgram),t.setChannel&&"function"==typeof t.setChannel&&(pt.setChannel=t.setChannel),t.emit&&"function"==typeof t.emit&&t.emit(emit$1)})(a.plugins.tv));const o=Application(e,0,a);return ut=new o(s),ut};class VideoTexture extends g.Component{static _template(){return{Video:{alpha:1,visible:!1,pivot:.5,texture:{type:g.textures.StaticTexture,options:{}}}}}set videoEl(t){this._videoEl=t}get videoEl(){return this._videoEl}get videoView(){return this.tag("Video")}get videoTexture(){return this.videoView.texture}get isVisible(){return 1===this.videoView.alpha&&!0===this.videoView.visible}_init(){this._createVideoTexture()}_createVideoTexture(){const t=this.stage.gl,e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),this.videoTexture.options={source:e,w:this.videoEl.width,h:this.videoEl.height},this.videoView.w=this.videoEl.width/this.stage.getRenderPrecision(),this.videoView.h=this.videoEl.height/this.stage.getRenderPrecision()}start(){const t=this.stage;this._updateVideoTexture||(this._updateVideoTexture=()=>{if(this.videoTexture.options.source&&this.videoEl.videoWidth&&this.active){const e=t.gl,i=(new Date).getTime(),a=this.videoEl.webkitDecodedFrameCount;if(a?this._lastFrame!==a:this._lastTime<i-30){this._lastTime=i,this._lastFrame=a;try{e.bindTexture(e.TEXTURE_2D,this.videoTexture.options.source),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.videoEl),this._lastFrame=this.videoEl.webkitDecodedFrameCount,this.videoView.visible=!0,this.videoTexture.options.w=this.videoEl.width,this.videoTexture.options.h=this.videoEl.height;const t=this.videoView.w/this.videoView.h,i=this.videoEl.width/this.videoEl.height;t>i?(this.videoView.scaleX=i/t,this.videoView.scaleY=1):(this.videoView.scaleY=t/i,this.videoView.scaleX=1)}catch(t){s.error("texImage2d video",t),this.stop()}this.videoTexture.source.forceRenderUpdate()}}}),this._updatingVideoTexture||(t.on("frameStart",this._updateVideoTexture),this._updatingVideoTexture=!0)}stop(){const t=this.stage;if(t.removeListener("frameStart",this._updateVideoTexture),this._updatingVideoTexture=!1,this.videoView.visible=!1,this.videoTexture.options.source){const e=t.gl;e.bindTexture(e.TEXTURE_2D,this.videoTexture.options.source),e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT)}}position(t,e){this.videoView.patch({smooth:{x:e,y:t}})}size(t,e){this.videoView.patch({smooth:{w:t,h:e}})}show(){this.videoView.setSmooth("alpha",1)}hide(){this.videoView.setSmooth("alpha",0)}}let mt,yt,ft,vt,mediaUrl$1=t=>t,_t=1,St=!1;const initVideoPlayer=t=>{t.mediaUrl&&(mediaUrl$1=t.mediaUrl)};let xt={};const wt={adsEnabled:!1,playing:!1,_playingAds:!1,get playingAds(){return this._playingAds},set playingAds(t){this._playingAds!==t&&(this._playingAds=t,fireOnConsumer(!0===t?"AdStart":"AdEnd"))},skipTime:!1,playAfterSeek:null},bt={play(){wt.playing=!0},pause(){wt.playing=!1},seeked(){!0===wt.playAfterSeek&&Pt.play(),wt.playAfterSeek=null},abort(){deregisterEventListeners()}},withPrecision=t=>Math.round(_t*t)+"px",fireOnConsumer=(t,e)=>{vt&&(vt.fire("$videoPlayer"+t,e),vt.fire("$videoPlayerEvent",t,e))},registerEventListeners=()=>{s.info("VideoPlayer","Registering event listeners"),Object.keys(o).forEach((t=>{const handler=e=>{ft&&ft[t]&&"function"==typeof ft[t]&&ft[t]({currentTime:mt.currentTime}),((t,e)=>{bt[t]&&"function"==typeof bt[t]&&bt[t].call(null,t,e)})(t,{videoElement:mt,event:e}),fireOnConsumer(o[t],{videoElement:mt,event:e})};xt[t]=handler,mt.addEventListener(t,handler)}))},deregisterEventListeners=()=>{s.info("VideoPlayer","Deregistering event listeners"),Object.keys(xt).forEach((t=>{mt.removeEventListener(t,xt[t])})),xt={}},Pt={consumer(t){vt=t},position(t=0,e=0){mt.style.left=withPrecision(e),mt.style.top=withPrecision(t),!0===St&&yt.position(t,e)},size(t=1920,e=1080){mt.style.width=withPrecision(t),mt.style.height=withPrecision(e),mt.width=parseFloat(mt.style.width),mt.height=parseFloat(mt.style.height),!0===St&&yt.size(t,e)},area(t=0,e=1920,i=1080,s=0){this.position(t,s),this.size(e-s,i-t)},open(t,e={}){if(!this.canInteract)return;ft=n.media(t),t=mediaUrl$1(t),this.src==t&&this.clear(),this.hide(),deregisterEventListeners(),mt.setAttribute("src",t),mt.load();const i={enabled:wt.adsEnabled,duration:300};e.videoId&&(i.caid=e.videoId),kt.get(i,vt).then((e=>{wt.playingAds=!0,e.prerolls().then((()=>{wt.playingAds=!1,registerEventListeners(),this.src!==t&&(mt.setAttribute("src",t),mt.load()),this.show(),setTimeout((()=>{this.play()}))}))}))},reload(){if(!this.canInteract)return;const t=mt.getAttribute("src");this.close(),this.open(t)},close(){kt.cancel(),wt.playingAds&&(wt.playingAds=!1,kt.stop(),setTimeout((()=>{this.close()}))),this.canInteract&&(this.clear(),this.hide(),deregisterEventListeners())},clear(){this.canInteract&&(this.pause(),!0===St&&yt.stop(),mt.removeAttribute("src"),mt.load())},play(){this.canInteract&&(!0===St&&yt.start(),mt.play())},pause(){this.canInteract&&mt.pause()},playPause(){this.canInteract&&(!0===this.playing?this.pause():this.play())},mute(t=!0){this.canInteract&&(mt.muted=t)},loop(t=!0){mt.loop=t},seek(t){this.canInteract&&this.src&&(null===wt.playAfterSeek&&(wt.playAfterSeek=!!wt.playing),this.pause(),mt.currentTime=Math.max(0,Math.min(t,this.duration-.1)))},skip(t){var e,i;this.canInteract&&(this.src&&(wt.skipTime=(wt.skipTime||mt.currentTime)+t,e=()=>{this.seek(wt.skipTime),wt.skipTime=!1},i=300,clearTimeout(r),r=setTimeout((()=>{e()}),i)))},show(){this.canInteract&&(!0===St?yt.show():(mt.style.display="block",mt.style.visibility="visible"))},hide(){this.canInteract&&(!0===St?yt.hide():(mt.style.display="none",mt.style.visibility="hidden"))},enableAds(t=!0){wt.adsEnabled=t},get duration(){return mt&&(isNaN(mt.duration)?1/0:mt.duration)},get currentTime(){return mt&&mt.currentTime},get muted(){return mt&&mt.muted},get looped(){return mt&&mt.loop},get src(){return mt&&mt.getAttribute("src")},get playing(){return wt.playing},get playingAds(){return wt.playingAds},get canInteract(){return!1===wt.playingAds},get top(){return mt&&parseFloat(mt.style.top)},get left(){return mt&&parseFloat(mt.style.left)},get bottom(){return mt&&parseFloat(mt.style.top-mt.style.height)},get right(){return mt&&parseFloat(mt.style.left-mt.style.width)},get width(){return mt&&parseFloat(mt.style.width)},get height(){return mt&&parseFloat(mt.style.height)},get visible(){return!0===St?yt.isVisible:mt&&"block"===mt.style.display},get adsEnabled(){return wt.adsEnabled},get _videoEl(){return mt}};let Tt;((t,e=(()=>{}))=>{let i=!1;const doSetup=()=>{!1===i&&(e(),i=!0)};Object.keys(t).reduce(((e,i)=>("function"==typeof t[i]?e[i]=function(){return doSetup(),t[i].apply(t,arguments)}:"function"==typeof Object.getOwnPropertyDescriptor(t,i).get?e.__defineGetter__(i,(function(){return doSetup(),Object.getOwnPropertyDescriptor(t,i).get.apply(t)})):"function"==typeof Object.getOwnPropertyDescriptor(t,i).set?e.__defineSetter__(i,(function(){return doSetup(),Object.getOwnPropertyDescriptor(t,i).set.sourceObject[i].apply(t,arguments)})):e[i]=t[i],e)),{})})(Pt,(()=>{_t=ut&&ut.stage&&ut.stage.getRenderPrecision(),mt=(()=>{const t=document.getElementsByTagName("video");if(t&&t.length)return t[0];{const t=document.createElement("video");return t.setAttribute("id","video-player"),t.setAttribute("width",withPrecision(1920)),t.setAttribute("height",withPrecision(1080)),t.setAttribute("crossorigin","anonymous"),t.style.position="absolute",t.style.zIndex="1",t.style.display="none",t.style.visibility="hidden",t.style.top=withPrecision(0),t.style.left=withPrecision(0),t.style.width=withPrecision(1920),t.style.height=withPrecision(1080),document.body.appendChild(t),t}})(),St=i.get("platform","textureMode",!1),!0===St&&(yt=(()=>{if(!ut.tag("VideoTexture")){const t=ut.stage.c({type:VideoTexture,ref:"VideoTexture",zIndex:0,videoEl:mt});ut.childList.addAt(t,0)}return ut.tag("VideoTexture")})())}));let getAds=()=>Promise.resolve({prerolls:[],midrolls:[],postrolls:[]});const initAds=t=>{t.getAds&&(getAds=t.getAds)},It={active:!1},playAd=t=>new Promise((e=>{if(!1===It.active)return s.info("Ad","Skipping add due to inactive state"),e();const i=document.getElementsByTagName("video")[0];i.style.display="block",i.style.visibility="visible",i.src=mediaUrl$1(t.url),i.load();let a,n=null;const cleanup=()=>{Object.keys(o).forEach((t=>i.removeEventListener(t,o[t]))),e()},o={play(){s.info("Ad","Play ad",t.url),fireOnConsumer$1("Play",t),sendBeacon(t.callbacks,"defaultImpression")},ended(){fireOnConsumer$1("Ended",t),sendBeacon(t.callbacks,"complete"),cleanup()},timeupdate(){!n&&i.duration&&(n={firstQuartile:i.duration/4,midPoint:i.duration/2,thirdQuartile:i.duration/4*3},s.info("Ad","Calculated quartiles times",{timeEvents:n})),n&&n.firstQuartile&&i.currentTime>=n.firstQuartile&&(fireOnConsumer$1("FirstQuartile",t),delete n.firstQuartile,sendBeacon(t.callbacks,"firstQuartile")),n&&n.midPoint&&i.currentTime>=n.midPoint&&(fireOnConsumer$1("MidPoint",t),delete n.midPoint,sendBeacon(t.callbacks,"midPoint")),n&&n.thirdQuartile&&i.currentTime>=n.thirdQuartile&&(fireOnConsumer$1("ThirdQuartile",t),delete n.thirdQuartile,sendBeacon(t.callbacks,"thirdQuartile"))},stalled(){fireOnConsumer$1("Stalled",t),a=setTimeout((()=>{cleanup()}),5e3)},canplay(){a&&clearTimeout(a)},error(){fireOnConsumer$1("Error",t),cleanup()},abort(){cleanup()}};Object.keys(o).forEach((t=>i.addEventListener(t,o[t]))),i.play()})),sendBeacon=(t,e)=>{if(t&&t[e])return s.info("Ad","Sending beacon",e,t[e]),t[e].reduce(((t,i)=>t.then((()=>fetch(i).then((t=>{200===t.status?fireOnConsumer$1("Beacon"+e+"Sent"):fireOnConsumer$1("Beacon"+e+"Failed"+t.status)})).catch((()=>{}))))),Promise.resolve(null));s.info("Ad","No callback found for "+e)},fireOnConsumer$1=(t,e)=>{Tt&&(Tt.fire("$ad"+t,e),Tt.fire("$adEvent",t,e))};var kt={get:(t,e)=>!1===t.enabled?Promise.resolve({prerolls:()=>Promise.resolve()}):(Tt=e,new Promise((e=>{s.info("Ad","Starting session"),getAds(t).then((t=>{s.info("Ad","API result",t),e({prerolls:()=>t.preroll?(It.active=!0,fireOnConsumer$1("PrerollSlotImpression",t),sendBeacon(t.preroll.callbacks,"slotImpression"),((t=[])=>t.reduce(((t,e)=>t.then((()=>playAd(e)))),Promise.resolve(null)))(t.preroll.ads).then((()=>{fireOnConsumer$1("PrerollSlotEnd",t),sendBeacon(t.preroll.callbacks,"slotEnd"),It.active=!1}))):Promise.resolve(),midrolls:()=>Promise.resolve(),postrolls:()=>Promise.resolve()})}))}))),cancel(){s.info("Ad","Cancel Ad"),It.active=!1},stop(){s.info("Ad","Stop Ad"),It.active=!1;const t=document.getElementsByTagName("video")[0];t.pause(),t.removeAttribute("src")}};g.textures.ImageTexture;g.Component;g.Component;class ListItem extends g.Component{static _template(){return{Item:{x:30,y:18,Shadow:{alpha:0,color:4289309097},Title:{text:{fontSize:27,textColor:4294967295},mountX:.5,alpha:0},Bg:{},Image:{}}}}_init(){this.data.show&&this.tag("Title").patch({x:this.x_text,y:this.y_text,alpha:1,text:{text:this.data.title}}),this.tag("Title").patch({x:this.x_text,y:this.y_text,text:{text:this.data.displayName}}),this.tag("Shadow").patch({scale:this.unfocus,texture:g.Tools.getShadowRect(this.w,this.h,4,10,0)}),this.tag("Bg").patch({rect:!0,color:4278190080,w:this.w,h:this.h}),this.data.url.startsWith("/images")?this.tag("Image").patch({src:c.asset(this.data.url),w:this.w,h:this.h,scale:this.unfocus}):this.tag("Image").patch({src:this.data.url,w:this.w,h:this.h})}_focus(){this.tag("Bg").scale=this.focus,this.tag("Image").patch({w:this.w,h:this.h,scale:this.focus}),this.tag("Title").patch({x:this.x_text,y:this.y_text,text:{text:this.data.displayName}}),this.tag("Shadow").patch({scale:this.focus,x:-7,y:-7,alpha:1,texture:g.Tools.getShadowRect(this.w+14,this.h+14,4,10,0)}),this.tag("Title").patch({alpha:1}),this.tag("Item").patch({zIndex:1})}_unfocus(){this.tag("Bg").scale=this.unfocus,this.tag("Image").patch({x:0,y:0,w:this.w,h:this.h,scale:this.unfocus}),this.tag("Shadow").patch({scale:this.unfocus,alpha:0}),this.tag("Title").patch({alpha:0}),this.tag("Item").patch({zIndex:0})}}let Ct=null;"undefined"!=typeof WebSocket&&(Ct=WebSocket);var At=Ct;const Lt={},Et={};var notificationListener=t=>{if("string"==typeof t&&(t=JSON.parse(t.normalize().replace(/\\x([0-9A-Fa-f]{2})/g,""))),!t.id&&t.method){const e=Et[t.method];e&&Array.isArray(e)&&e.length&&e.forEach((e=>{e(t.params)}))}};let Dt=null;var connect=t=>new Promise(((e,i)=>{if(Dt&&1===Dt.readyState)return e(Dt);if(Dt&&0===Dt.readyState){const waitForOpen=()=>{Dt.removeEventListener("open",waitForOpen),e(Dt)};return Dt.addEventListener("open",waitForOpen)}if(null===Dt){Dt=new At((t=>[t&&t.protocol||"ws://",t&&t.host||"localhost",":"+(t&&t.port||80),t&&t.endpoint||"/jsonrpc",t&&t.token?"?token="+t.token:null].join(""))(t),"notification"),Dt.addEventListener("message",(e=>{t.debug&&(console.log(" "),console.log("API REPONSE:"),console.log(JSON.stringify(e.data,null,2)),console.log(" ")),(t=>{if("string"==typeof t&&(t=JSON.parse(t.normalize().replace(/\\x([0-9A-Fa-f]{2})/g,""))),t.id){const e=Lt[t.id];e?("result"in t?e.resolve(t.result):e.reject(t.error),delete Lt[t.id]):console.log("no pending request found with id "+t.id)}})(e.data)})),Dt.addEventListener("message",(t=>{notificationListener(t.data)})),Dt.addEventListener("error",(()=>{notificationListener({method:"client.ThunderJS.events.error"}),Dt=null}));const handleConnectClosure=t=>{Dt=null,i(t)};Dt.addEventListener("close",handleConnectClosure),Dt.addEventListener("open",(()=>{notificationListener({method:"client.ThunderJS.events.connect"}),Dt.removeEventListener("close",handleConnectClosure),Dt.addEventListener("close",(()=>{notificationListener({method:"client.ThunderJS.events.disconnect"}),Dt=null})),e(Dt)}))}else Dt=null,i("Socket error")}));let Rt=0;var API=t=>({request:(e,i,s)=>new Promise(((a,n)=>{const o=(Rt+=1,Rt),r=((t,e,i)=>{let s;return(s=i&&i.version)?s:t&&(t[e]||t.default)||1})(t.versions,e,s),l=((t,e,i,s,a)=>{s&&delete s.version;const n={jsonrpc:"2.0",id:t,method:[e,a,i].join(".")};return(s||!1===s)&&("object"!=typeof s||0!==Object.keys(s).length)&&(n.params=s),n})(o,e,i,s,r);t.debug&&(console.log(" "),console.log("API REQUEST:"),console.log(JSON.stringify(l,null,2)),console.log(" ")),Lt[o]={body:l,resolve:a,reject:n},((t,e)=>connect(t).then((t=>{t.send(JSON.stringify(e))})))(t,l).catch((t=>{n(t)}))}))}),Nt={DeviceInfo:{freeRam(t){return this.call("systeminfo",t).then((t=>t.freeram))},version(t){return this.call("systeminfo",t).then((t=>t.version))}}};function listener(t,e,i,s){const a=this,n=register$1.call(this,t,e,i,s);return{dispose(){const i=makeListenerId(t,e);void 0!==Et[i]&&(Et[i].splice(n,1),0===Et[i].length&&unregister.call(a,t,e,s))}}}const makeListenerId=(t,e)=>["client",t,"events",e].join("."),register$1=function(t,e,i,s){const a=makeListenerId(t,e);if(!Et[a]&&(Et[a]=[],"ThunderJS"!==t)){const i="register",n={event:e,id:a.split(".").slice(0,-1).join(".")};this.api.request(t,i,n).catch((t=>{"function"==typeof s&&s(t.message)}))}return Et[a].push(i),Et[a].length-1},unregister=function(t,e,i){const s=makeListenerId(t,e);if(delete Et[s],"ThunderJS"!==t){const a="unregister",n={event:e,id:s.split(".").slice(0,-1).join(".")};this.api.request(t,a,n).catch((t=>{"function"==typeof i&&i(t.message)}))}};let Ft;var thunderJS=t=>(void 0===t.token&&"undefined"!=typeof window&&window.thunder&&"function"==typeof window.thunder.token&&(t.token=window.thunder.token()),Ft=API(t),wrapper({...thunder(t),...Nt}));const thunder=t=>({options:t,plugin:!1,call(){const t=[...arguments];this.plugin&&t[0]!==this.plugin&&t.unshift(this.plugin);const e=t[0],i=t[1];return"function"==typeof this[e][i]?this[e][i](t[2]):this.api.request.apply(this,t)},registerPlugin(t,e){this[t]=wrapper(Object.assign(Object.create(thunder),e,{plugin:t}))},subscribe(){},on(){const t=[...arguments];return-1!==["connect","disconnect","error"].indexOf(t[0])?t.unshift("ThunderJS"):this.plugin&&t[0]!==this.plugin&&t.unshift(this.plugin),listener.apply(this,t)},once(){console.log("todo ...")}}),wrapper=t=>new Proxy(t,{get(t,e){const i=t[e];return"api"===e?Ft:void 0!==i?"function"==typeof i?["on","once","subscribe"].indexOf(e)>-1?function(...t){return i.apply(this,t)}:function(...t){return((t,e)=>{"object"==typeof t&&("object"!=typeof t||t.then&&"function"==typeof t.then)||(t=new Promise(((e,i)=>{t instanceof Error==0?e(t):i(t)})));const i="function"==typeof e[e.length-1]?e[e.length-1]:null;if(!i)return t;t.then((t=>i(null,t))).catch((t=>i(t)))})(i.apply(this,t),t)}:"object"==typeof i?wrapper(Object.assign(Object.create(thunder(t.options)),i,{plugin:e})):i:!1===t.plugin?wrapper(Object.assign(Object.create(thunder(t.options)),{},{plugin:e})):function(...i){return i.unshift(e),t.call.apply(this,i)}}});var Ot=!1,Mt=!1,Bt=!1,Vt="",jt="";var Ut,zt=thunderJS({host:"127.0.0.1",port:9998,default:1});class AppApi{checkForInternet(){return new Promise(((t,e)=>{let i=0;var poll=()=>{i++,this.getIP().then((e=>{1==e?t(e):i<10?poll():t(!1)}))};poll()}))}getIP(){return new Promise(((t,e)=>{const i="org.rdk.System";zt.Controller.activate({callsign:i}).then((()=>{zt.call(i,"getDeviceInfo",{params:"estb_ip"}).then((e=>{t(e.success)})).catch((e=>{t(!1)}))})).catch((t=>{}))}))}getResolution(){return new Promise(((t,e)=>{const i="org.rdk.DisplaySettings";zt.Controller.activate({callsign:i}).then((()=>{zt.call(i,"getCurrentResolution",{params:"HDMI0"}).then((e=>{t(e.resolution)})).catch((e=>{t(!1)}))})).catch((t=>{console.log("Display Error",t)}))}))}setResolution(){return new Promise(((t,e)=>{const i="org.rdk.DisplaySettings";zt.Controller.activate({callsign:i}).then((()=>{zt.call(i,"setCurrentResolution",{videoDisplay:"HDMI0",resolution:"1080p",persist:!0}).then((e=>{t(e.success)})).catch((e=>{t(!1)}))})).catch((t=>{console.log("Display Error",t)}))}))}launchWeb(t){const e="HtmlApp";Vt!=t?zt.call("org.rdk.RDKShell","launch",{callsign:e,type:e,uri:t}).then((()=>{zt.call("org.rdk.RDKShell","moveToFront",{client:e}),zt.call("org.rdk.RDKShell","setFocus",{client:e})})).catch((t=>{})):(zt.call("org.rdk.RDKShell","moveToFront",{client:e}),zt.call("org.rdk.RDKShell","setFocus",{client:e})),Vt=t,Ot=!0}launchLightning(t){const e="LightningApp";jt!=t?zt.call("org.rdk.RDKShell","launch",{callsign:e,type:e,uri:t}).then((()=>{zt.call("org.rdk.RDKShell","moveToFront",{client:e}),zt.call("org.rdk.RDKShell","setFocus",{client:e})})).catch((t=>{})):(zt.call("org.rdk.RDKShell","moveToFront",{client:e}),zt.call("org.rdk.RDKShell","setFocus",{client:e})),jt=t,Mt=!0}launchCobalt(t){const e="Cobalt";zt.call("org.rdk.RDKShell","launch",{callsign:e,type:e}).then((()=>{zt.call("org.rdk.RDKShell","moveToFront",{client:e}),zt.call("org.rdk.RDKShell","setFocus",{client:e})})).catch((t=>{})),Bt=!0}launchResident(t){const e="ResidentApp";zt.call("org.rdk.RDKShell","launch",{callsign:e,type:e,uri:t}).then((()=>{zt.call("org.rdk.RDKShell","moveToFront",{client:e}),zt.call("org.rdk.RDKShell","setFocus",{client:e})})).catch((t=>{console.log("org.rdk.RDKShell launch "+JSON.stringify(t))}))}suspendWeb(){Vt="",zt.call("org.rdk.RDKShell","suspend",{callsign:"HtmlApp"})}suspendLightning(){jt="",zt.call("org.rdk.RDKShell","suspend",{callsign:"LightningApp"})}suspendCobalt(){zt.call("org.rdk.RDKShell","suspend",{callsign:"Cobalt"})}deactivateWeb(){zt.call("org.rdk.RDKShell","destroy",{callsign:"HtmlApp"}),Ot=!1,Vt=""}deactivateCobalt(){zt.call("org.rdk.RDKShell","destroy",{callsign:"Cobalt"}),Bt=!1}deactivateLightning(){zt.call("org.rdk.RDKShell","destroy",{callsign:"LightningApp"}),Mt=!1,jt=""}setVisibility(t,e){zt.call("org.rdk.RDKShell","setVisibility",{client:t,visible:e})}static pluginStatus(t){switch(t){case"WebApp":return Ot;case"Cobalt":return Bt;case"Lightning":return Mt}}}class MainView extends g.Component{static _template(){return{MainView:{x:451,y:225,w:1469,h:820,AppList:{x:0,y:0,type:g.components.ListComponent,w:1469,h:209,itemSize:224,roll:!0,rollMax:1469,horizontal:!0,itemScrollOffset:-5,clipping:!0},TVShows:{x:0,y:184,w:1469,h:335,type:g.components.ListComponent,roll:!0,itemSize:448,horizontal:!0,rollMax:1469,clipping:!0},Settings:{x:0,y:494,w:1469,h:335,type:g.components.ListComponent,roll:!0,itemSize:448,horizontal:!0,rollMax:1469,clipping:!0}}}}_init(){this.settingsScreen=!1,this._setState("AppList"),this.indexVal=0;var t=thunderJS({host:"127.0.0.1",port:9998,default:1});const e="org.rdk.RDKShell";t.Controller.activate({callsign:e}).then((t=>{console.log("Successfully activated RDK Shell")})).catch((t=>{console.log("Error",t)})).then((e=>{t.call("org.rdk.RDKShell","setFocus",{client:"ResidentApp"})})).catch((t=>{console.log("Error",t)})).then((i=>{t.call(e,"addKeyIntercept",{client:"ResidentApp",keyCode:77,modifiers:[]}).then((t=>{console.log("addKeyIntercept success")})).catch((t=>{console.log("Error",t)}))})).catch((t=>{console.log("Error",t)})).then((i=>{t.call(e,"addKeyIntercept",{client:"ResidentApp",keyCode:49,modifiers:[]}).then((t=>{console.log("addKeyIntercept success")})).catch((t=>{console.log("Error",t)}))})).catch((t=>{console.log("Error",t)})).then((i=>{t.call(e,"addKeyIntercept",{client:"ResidentApp",keyCode:36,modifiers:[]}).then((t=>{console.log("addKeyIntercept success")})).catch((t=>{console.log("Error",t)}))})).catch((t=>{console.log("Error",t)})).then((i=>{t.call(e,"addKeyIntercept",{client:"ResidentApp",keyCode:158,modifiers:[]}).then((t=>{console.log("addKeyIntercept success")})).catch((t=>{console.log("Error",t)}))})).catch((t=>{console.log("Error",t)})).then((e=>{t.on("Controller","statechange",(e=>{e&&"Cobalt"==e.callsign&&"Deactivation"==e.state&&((new AppApi).setVisibility("ResidentApp",!0),t.call("org.rdk.RDKShell","moveToFront",{client:"ResidentApp"}).then((t=>{console.log("ResidentApp moveToFront Success"+JSON.stringify(t))})),t.call("org.rdk.RDKShell","setFocus",{client:"ResidentApp"}).then((t=>{console.log("ResidentApp setFocus Success"+JSON.stringify(t))})).catch((t=>{console.log("Error",t)})))}))})).catch((t=>{console.log("Error",t)}))}_active(){if(this.settingsScreen){let t=this.parent;this._appAnimation=t.animation({duration:0,repeat:0,stopMethod:"immediate",actions:[{p:"x",v:{0:0,1:-320}},{p:"y",v:{0:0,1:-180}},{p:"scale",v:{0:1,1:1.17}}]}),this._appAnimation.start(),this.settingsScreen=!1}}set appItems(t){this.tag("AppList").items=t.map((t=>({w:204,h:126,type:ListItem,data:t,focus:1.2,unfocus:1,x_text:106,y_text:140}))),this.tag("AppList").start()}set tvShowItems(t){this.tag("TVShows").items=t.map((t=>({w:428,h:252,type:ListItem,data:t,focus:1.08,unfocus:1,x_text:218,y_text:264}))),this.tag("TVShows").start()}set settingsItems(t){this.tag("Settings").items=t.map((t=>({w:428,h:252,type:ListItem,data:t,focus:1.08,unfocus:1,x_text:218,y_text:264}))),this.tag("Settings").start()}set index(t){this.indexVal=t,0==this.indexVal?this._setState("AppList"):1==this.indexVal?this._setState("TVShows"):2==this.indexVal&&this._setState("Settings")}reset(){for(var t=this.tag("AppList").index;t>0;t--)this.tag("AppList").setPrevious();for(t=this.tag("TVShows").index;t>0;t--)this.tag("TVShows").setPrevious();for(t=this.tag("Settings").index;t>0;t--)this.tag("Settings").setPrevious()}static _states(){return[class AppList extends(this){_getFocused(){if(this.tag("AppList").length)return this.tag("AppList").element}_handleRight(){if(this.tag("AppList").length-1!=this.tag("AppList").index)return this.tag("AppList").setNext(),this.tag("AppList").element}_handleLeft(){if(0!=this.tag("AppList").index)return this.tag("AppList").setPrevious(),this.tag("AppList").element;this.reset(),this.fireAncestors("$goToSidePanel",0)}_handleDown(){this._setState("TVShows")}_handleEnter(){var t=new AppApi;this.applicationType=this.tag("AppList").items[this.tag("AppList").index].data.applicationType,this.uri=this.tag("AppList").items[this.tag("AppList").index].data.uri,"Cobalt"==this.applicationType?(t.launchCobalt(this.uri),t.setVisibility("ResidentApp",!1)):"WebApp"==this.applicationType?(t.launchWeb(this.uri),t.setVisibility("ResidentApp",!1)):"Lightning"==this.applicationType&&(t.launchLightning(this.uri),t.setVisibility("ResidentApp",!1))}_handleKey(t){var e=thunderJS({host:"127.0.0.1",port:9998,default:1});if(console.log("_handleKey",t.keyCode),77==t.keyCode||49==t.keyCode||36==t.keyCode||158==t.keyCode){var i=new AppApi;"Cobalt"==this.applicationType?(i.suspendCobalt(),i.setVisibility("ResidentApp",!0)):"WebApp"==this.applicationType?(i.deactivateWeb(),i.setVisibility("ResidentApp",!0)):"Lightning"==this.applicationType&&(i.deactivateLightning(),i.setVisibility("ResidentApp",!0)),e.call("org.rdk.RDKShell","moveToFront",{client:"ResidentApp"}).then((t=>{console.log("ResidentApp moveToFront Success")})),e.call("org.rdk.RDKShell","setFocus",{client:"ResidentApp"}).then((t=>{console.log("ResidentApp moveToFront Success")})).catch((t=>{console.log("Error",t)}))}}},class TVShows extends(this){_getFocused(){if(this.tag("TVShows").length)return this.tag("TVShows").element}_handleRight(){if(this.tag("TVShows").length-1!=this.tag("TVShows").index)return this.tag("TVShows").setNext(),this.tag("TVShows").element}_handleLeft(){if(0!=this.tag("TVShows").index)return this.tag("TVShows").setPrevious(),this.tag("TVShows").element;this.reset(),this.fireAncestors("$goToSidePanel",1)}_handleUp(){this._setState("AppList")}_handleDown(){this._setState("Settings")}_handleEnter(){this.fireAncestors("$goToPlayer")}},class Settings extends(this){_getFocused(){if(this.tag("Settings").length)return this.tag("Settings").element}_handleRight(){return this.tag("Settings").length-1!=this.tag("Settings").index&&this.tag("Settings").setNext(),this.tag("Settings").element}_handleLeft(){if(0!=this.tag("Settings").index)return this.tag("Settings").setPrevious(),this.tag("Settings").element;this.reset(),this.fireAncestors("$goToSidePanel",2)}_handleUp(){this._setState("TVShows")}_handleEnter(){this.settingsType=this.tag("Settings").items[this.tag("Settings").index].data.displayName,"Bluetooth"==this.settingsType?(this.settingsScreen=!0,lt("settings/BluetoothScreen",!1)):"Wi-Fi"==this.settingsType&&(this.settingsScreen=!0,lt("settings/WiFiScreen",!1))}}]}}class SidePanelItem extends g.Component{static _template(){return{Item:{Title:{text:{fontSize:27,textColor:4294967295},mountX:.5,alpha:0},Image:{x:0}}}}_init(){this.tag("Title").patch({x:this.x_text,y:this.y_text,text:{text:this.data.title}}),this.tag("Image").patch({src:c.asset(this.data.url),w:this.w,h:this.h,scale:this.unfocus})}_focus(){this.tag("Image").patch({w:this.w,h:this.h,scale:this.focus}),this.tag("Title").patch({alpha:1}),this.tag("Item").patch({zIndex:1})}_unfocus(){this.tag("Image").patch({w:this.w,h:this.h,scale:this.unfocus}),this.tag("Title").patch({alpha:0}),this.tag("Item").patch({zIndex:0})}}class SidePanel extends g.Component{static _template(){return{SidePanel:{x:130,y:200,w:240,h:750,type:g.components.ListComponent,roll:!0,horizontal:!1,invertDirection:!0}}}_init(){this._setState("SidePanel"),this.indexVal=0}set sidePanelItems(t){this.tag("SidePanel").patch({x:130}),this.tag("SidePanel").items=t.map(((t,e)=>(this.data=t,{w:204,h:184,y:0==e?20:1==e?180:370,type:SidePanelItem,data:t,focus:.7,unfocus:.6,x_text:100,y_text:160,text_focus:1.1,text_unfocus:.9}))),this.tag("SidePanel").start()}set resetSidePanelItems(t){this.tag("SidePanel").patch({x:90}),this.tag("SidePanel").items=t.map(((t,e)=>({w:204,h:184,y:0==e?20:1==e?180:370,type:SidePanelItem,data:t,focus:.7,unfocus:.4,x_text:100,y_text:160,text_focus:1.1,text_unfocus:.9}))),this.tag("SidePanel").start()}set scale(t){this.tag("SidePanel").patch({scale:t})}set x(t){this.tag("SidePanel").patch({x:t})}set index(t){this.indexVal=t}static _states(){return[class SidePanel extends(this){_getFocused(){if(this.tag("SidePanel").length)return this.tag("SidePanel").items[this.indexVal]}_handleKey(t){if(39==t.keyCode||13==t.keyCode)this.fireAncestors("$goToMainView",this.indexVal);else{if(40==t.keyCode)return this.tag("SidePanel").length-1!=this.indexVal&&(this.indexVal=this.indexVal+1),this.tag("SidePanel").items[this.indexVal];if(38==t.keyCode)return 0!=this.indexVal&&(this.indexVal=this.indexVal-1),this.tag("SidePanel").items[this.indexVal]}}}]}}class TopPanel extends g.Component{static _template(){return{TopPanel:{x:90,y:60,w:1740,h:120,Mic:{x:120,y:60,mountY:.5,src:c.asset("/images/topPanel/mic.png"),w:60,h:60},Search:{x:250,y:60,mountY:.5,text:{text:"Search TV shows, movies and more",fontSize:33}},Time:{x:1500,y:60,mountY:.5,text:{text:"",fontSize:38}}}}}_init(){this.timeZone="America/New_York";thunderJS({host:"127.0.0.1",port:9998,default:1}).call("org.rdk.System","getTimeZoneDST").then((t=>{t.success&&(this.timeZone=t.timeZone)})).catch((t=>{this.timeZone="America/New_York"}))}_build(){setInterval((()=>{this.tag("Time").patch({text:{text:this.updateTime()}})}),1e3)}updateTime(){let t=new Date;t=new Date(t.toLocaleString("en-US",{timeZone:this.timeZone}));let e=t.getHours(),i=t.getMinutes(),s=e>=12?"pm":"am";return e%=12,e=e||12,i=i<10?"0"+i:i,e+"."+i+" "+s}}class PlayerControls extends g.Component{static _template(){return{rect:!0,w:1920,h:410,color:1076176426,Title:{x:90,y:15},Subtitle:{x:90,y:88.5},NetworkLogo:{x:1740,y:82.5},TimeBar:{x:90,y:163.5,texture:g.Tools.getRoundRect(1740,6,6,0,0,!0,2163143155)},ProgressBar:{x:90,y:163.5},CurrentTime:{x:90,y:184.5},TotalTime:{x:1680,y:184.5},Buttons:{x:820,y:240,children:[{src:c.asset("images/player/rewind.png"),x:17,y:17},{src:c.asset("images/player/pause-focus.png"),x:17,y:17},{src:c.asset("images/player/fast-forward.png"),x:17,y:17}].map(((t,e)=>({x:100*e,texture:g.Tools.getRoundRect(80,80,40,0,0,!0,4287532686),ControlIcon:{x:t.x,y:t.y,texture:g.Tools.getSvgTexture(t.src,50,50)}})))},Audio:{x:90,y:240,texture:g.Tools.getRoundRect(240,90,6,0,0,!0,4287532686),AudioOptions:{x:0,y:25,w:240,h:90,text:{fontSize:30,text:"Audio Options",textColor:4294967295,textAlign:"center"}}},Extras:{x:1700,y:240,texture:g.Tools.getRoundRect(130,90,6,0,0,!0,4287532686),ExtrasOptions:{x:0,y:25,w:130,h:90,text:{fontSize:30,text:"Extras",textColor:4294967295,textAlign:"center"}}}}}_init(){this.videoDuration=0,this.tag("Buttons").children[0].patch({alpha:.4}),this.tag("Buttons").children[2].patch({alpha:.4}),this.tag("Audio").patch({alpha:.4}),this.tag("Extras").patch({alpha:.4})}_focus(){this._index=1,this.toggle=!1,this._setState("PlayPause")}_unfocus(){this._setState("Hidden"),clearTimeout(Ut)}set title(t){this.tag("Title").patch({text:{fontSize:52.5,textAlign:"center",text:t}})}set subtitle(t){this.tag("Subtitle").patch({text:{fontSize:36,textAlign:"center",text:t}})}set logoPath(t){this.tag("NetworkLogo").patch({src:t})}set duration(t){this.videoDuration=t,this.tag("TotalTime").patch({text:{fontSize:33,textAlign:"center",text:this.SecondsTohhmmss(t)}})}set currentTime(t){this.tag("CurrentTime").patch({text:{fontSize:33,textAlign:"center",text:this.SecondsTohhmmss(t)}}),this.tag("ProgressBar").patch({texture:g.Tools.getRoundRect(1740*t/this.videoDuration,6,6,0,0,!0,4294967295),SeekBar:{x:1740*t/this.videoDuration,y:-12,texture:g.Tools.getRoundRect(30,30,15,0,0,!0,4294967295)}})}SecondsTohhmmss(t){return this.hours=Math.floor(t/3600),this.minutes=Math.floor((t-3600*this.hours)/60),this.seconds=t-3600*this.hours-60*this.minutes,this.seconds=Math.round(t)-3600*this.hours-60*this.minutes,this.result=this.hours<10?"0"+this.hours:this.hours,this.result+=":"+(this.minutes<10?"0"+this.minutes:this.minutes),this.result+=":"+(this.seconds<10?"0"+this.seconds:this.seconds),this.result}hidePlayerControls(){this.signal("hide")}reset(t="play"){if(this._setState("PlayPause"),"pause"===t||"stop"===t)return this.tag("Buttons").children[1].tag("ControlIcon").patch({texture:g.Tools.getSvgTexture(c.asset("images/player/play-focus.png"),50,50),x:17}),void(this.toggle=1);this.tag("Buttons").children[1].tag("ControlIcon").patch({texture:g.Tools.getSvgTexture(c.asset("images/player/pause-focus.png"),50,50),x:17}),this.toggle=0}timer(){clearTimeout(Ut),Ut=setTimeout(this.hidePlayerControls.bind(this),5e3)}static _states(){return[class AudioOptions extends(this){$enter(){this.timer(),this.tag("Audio").patch({texture:g.Tools.getRoundRect(240,90,6,0,0,!0,4294967295),scale:1.1}),this.tag("Audio").tag("AudioOptions").color=4278190080}$exit(){this.tag("Audio").patch({texture:g.Tools.getRoundRect(240,90,6,0,0,!0,4287532686),scale:1}),this.tag("Audio").tag("AudioOptions").color=4294967295}_handleRight(){this._setState("Rewind")}_getFocused(){this.timer()}},class PlayPause extends(this){$enter(){this.focus=this.toggle?c.asset("images/player/play-focus.png"):c.asset("images/player/pause-focus.png"),this.timer(),this.tag("Buttons").children[1].patch({texture:g.Tools.getRoundRect(80,80,40,0,0,!0,4294967295),scale:1.1}),this.tag("Buttons").children[1].tag("ControlIcon").patch({texture:g.Tools.getSvgTexture(this.focus,50,50)})}$exit(){this.unfocus=this.toggle?c.asset("images/player/play.png"):c.asset("images/player/pause.png"),this.tag("Buttons").children[1].patch({texture:g.Tools.getRoundRect(80,80,40,0,0,!0,4287532686),scale:1}),this.tag("Buttons").children[1].tag("ControlIcon").patch({texture:g.Tools.getSvgTexture(this.unfocus,50,50)})}_handleEnter(){this.toggle?this.signal("play"):this.signal("pause"),this.toggle=!this.toggle,this.focus=this.toggle?c.asset("images/player/play-focus.png"):c.asset("images/player/pause-focus.png"),this.timer(),this.tag("Buttons").children[1].patch({texture:g.Tools.getRoundRect(80,80,40,0,0,!0,4294967295)}),this.tag("Buttons").children[1].tag("ControlIcon").patch({texture:g.Tools.getSvgTexture(this.focus,50,50)})}_handleRight(){}_handleLeft(){}_getFocused(){this.timer()}},class Forward extends(this){$enter(){this.timer(),this.tag("Buttons").children[2].patch({texture:g.Tools.getRoundRect(80,80,40,0,0,!0,4294967295),scale:1.1}),this.tag("Buttons").children[2].tag("ControlIcon").patch({texture:g.Tools.getSvgTexture(c.asset("images/player/fast-forward-focus.png"),50,50)})}$exit(){this.tag("Buttons").children[2].patch({texture:g.Tools.getRoundRect(80,80,40,0,0,!0,4287532686),scale:1}),this.tag("Buttons").children[2].tag("ControlIcon").patch({texture:g.Tools.getSvgTexture(c.asset("images/player/fast-forward.png"),50,50)})}_handleRight(){this._setState("Extras")}_handleLeft(){this._setState("PlayPause")}_handleEnter(){this.signal("fastfwd")}_getFocused(){this.timer()}},class Rewind extends(this){$enter(){this.timer(),this.tag("Buttons").children[0].patch({texture:g.Tools.getRoundRect(80,80,40,0,0,!0,4294967295),scale:1.1}),this.tag("Buttons").children[0].tag("ControlIcon").patch({texture:g.Tools.getSvgTexture(c.asset("images/player/rewind-focus.png"),50,50)})}$exit(){this.tag("Buttons").children[0].patch({texture:g.Tools.getRoundRect(80,80,40,0,0,!0,4287532686),scale:1}),this.tag("Buttons").children[0].tag("ControlIcon").patch({texture:g.Tools.getSvgTexture(c.asset("images/player/rewind.png"),50,50)})}_handleLeft(){this._setState("AudioOptions")}_handleRight(){this._setState("PlayPause")}_handleEnter(){this.signal("fastrwd")}_getFocused(){this.timer()}},class Extras extends(this){$enter(){this.tag("Extras").patch({texture:g.Tools.getRoundRect(130,90,6,0,0,!0,4294967295),scale:1.1}),this.tag("Extras").tag("ExtrasOptions").color=4278190080,this.timer()}_handleLeft(){this._setState("Forward")}_getFocused(){this.timer()}$exit(){this.tag("Extras").patch({texture:g.Tools.getRoundRect(130,90,6,0,0,!0,4287532686),scale:1}),this.tag("Extras").tag("ExtrasOptions").color=4294967295}},class Hidden extends(this){_getFocused(){}}]}}class AAMPVideoPlayer extends g.Component{static _template(){return{PlayerControls:{type:PlayerControls,x:0,y:810,alpha:0,signals:{pause:"pause",play:"play",hide:"hidePlayerControls",fastfwd:"fastfwd",fastrwd:"fastrwd"}}}}_init(){this.x=0,this.y=0,this.w=0,this.h=0,this.videoEl=document.createElement("video"),this.videoEl.setAttribute("id","video-player"),this.videoEl.style.position="absolute",this.videoEl.style.zIndex="1",this.videoEl.setAttribute("width","100%"),this.videoEl.setAttribute("height","100%"),this.videoEl.setAttribute("src","placeholder.mp4"),this.videoEl.setAttribute("type","video/ave"),document.body.appendChild(this.videoEl),this.playbackSpeeds=[-16,-8,-4,-2,1,2,4,8,16],this.playerStatesEnum={idle:0,initializing:1,playing:8,paused:6,seeking:7},this.player=null,this.playbackRateIndex=this.playbackSpeeds.indexOf(1),this.defaultInitConfig={initialBitrate:25e5,offset:0,networkTimeout:10,preferredAudioLanguage:"en",liveOffset:15,drmConfig:null}}setVideoRect(t,e,i,s){this.x=t,this.y=e,this.w=i,this.h=s;var a=.67*t,n=.67*e,o=.67*i,r=.67*s;this.player.setVideoRect(a,n,o,r)}_playbackStateChanged(t){switch(t.state){case this.player.playerStatesEnum.idle:this.playerState=this.player.playerStatesEnum.idle;break;case this.player.playerStatesEnum.initializing:this.playerState=this.player.playerStatesEnum.initializing;break;case this.player.playerStatesEnum.playing:this.playerState=this.player.playerStatesEnum.playing;break;case this.player.playerStatesEnum.paused:this.playerState=this.player.playerStatesEnum.paused;break;case this.player.playerStatesEnum.seeking:this.playerState=this.player.playerStatesEnum.seeking}}_mediaEndReached(){this.load(this.videoInfo),this.setVideoRect(this.x,this.y,this.w,this.h)}_mediaSpeedChanged(){}_bitrateChanged(){}_mediaPlaybackFailed(){this.load(this.videoInfo)}_mediaProgressUpdate(t){this.position=t.positionMiliseconds/1e3,this.tag("PlayerControls").currentTime=this.position}_mediaPlaybackStarted(){}_mediaDurationChanged(){}createPlayer(){null!==this.player&&(this.destroy(),this.player=null);try{this.player=new AAMPMediaPlayer,this.player.addEventListener("playbackStateChanged",this._playbackStateChanged),this.player.addEventListener("playbackCompleted",this._mediaEndReached.bind(this)),this.player.addEventListener("playbackSpeedChanged",this._mediaSpeedChanged),this.player.addEventListener("bitrateChanged",this._bitrateChanged),this.player.addEventListener("playbackFailed",this._mediaPlaybackFailed.bind(this)),this.player.addEventListener("playbackProgressUpdate",this._mediaProgressUpdate.bind(this)),this.player.addEventListener("playbackStarted",this._mediaPlaybackStarted.bind(this)),this.player.addEventListener("durationChanged",this._mediaDurationChanged),this.playerState=this.playerStatesEnum.idle}catch(t){console.error("AAMPMediaPlayer is not defined")}}load(t){this.createPlayer(),this.videoInfo=t,this.configObj=this.defaultInitConfig,this.configObj.drmConfig=this.videoInfo.drmConfig,this.player.initConfig(this.configObj),this.player.load(t.url),this.tag("PlayerControls").title=t.title,this.tag("PlayerControls").subtitle=t.subtitle,this.tag("PlayerControls").logoPath=t.logoPath,this.tag("PlayerControls").duration=this.player.getDurationSec(),this.tag("PlayerControls").currentTime=0,this.play()}play(){this.player.play(),this.playbackRateIndex=this.playbackSpeeds.indexOf(1)}pause(){this.player.pause()}stop(){this.player.stop(),this.hidePlayerControls()}fastfwd(){this.playbackRateIndex<this.playbackSpeeds.length-1&&this.playbackRateIndex++,this.rate=this.playbackSpeeds[this.playbackRateIndex],this.player.setPlaybackRate(this.rate)}fastrwd(){this.playbackRateIndex>0&&this.playbackRateIndex--,this.rate=this.playbackSpeeds[this.playbackRateIndex],this.player.setPlaybackRate(this.rate)}getPlayer(){return this.player}destroy(){this.player.getCurrentState()!==this.playerStatesEnum.idle&&this.player.stop(),this.player.removeEventListener("playbackStateChanged",this._playbackStateChanged),this.player.removeEventListener("playbackCompleted",this._mediaEndReached),this.player.removeEventListener("playbackSpeedChanged",this._mediaSpeedChanged),this.player.removeEventListener("bitrateChanged",this._bitrateChanged),this.player.removeEventListener("playbackFailed",this._mediaPlaybackFailed.bind(this)),this.player.removeEventListener("playbackProgressUpdate",this._mediaProgressUpdate.bind(this)),this.player.removeEventListener("playbackStarted",this._mediaPlaybackStarted.bind(this)),this.player.removeEventListener("durationChanged",this._mediaDurationChanged),this.player.release(),this.player=null,this.hidePlayerControls()}hidePlayerControls(){this.tag("PlayerControls").setSmooth("y",1080,{duration:.7}),this.tag("PlayerControls").setSmooth("alpha",0,{duration:.7}),this._setState("HideControls")}showPlayerControls(){this.tag("PlayerControls").reset(),this.tag("PlayerControls").setSmooth("alpha",1),this.tag("PlayerControls").setSmooth("y",675,{duration:.7}),this._setState("ShowControls"),this.timeout=setTimeout(this.hidePlayerControls.bind(this),5e3)}_handleDown(){this.tag("PlayerControls").setSmooth("alpha",1,{duration:1}),this.tag("PlayerControls").setSmooth("y",675,{duration:1}),this._setState("ShowControls"),clearTimeout(this.timeout)}_handleUp(){this.hidePlayerControls(),this._setState("HideControls")}static _states(){return[class ShowControls extends(this){_getFocused(){return this.tag("PlayerControls")}},class HideControls extends(this){_getFocused(){}}]}}var $t=[{displayName:"Test Youtube",applicationType:"Cobalt",uri:"https://www.youtube.com/tv",url:"/images/apps/youtube.png"},{displayName:"AppStore",applicationType:"Lightning",uri:"https://widgets.metrological.com/lightning/rdk/d431ce8577be56e82630650bf701c57d",url:"/images/apps/metrological.jpg"},{displayName:"Test Xumo",applicationType:"WebApp",uri:"https://x1box-app.xumo.com/3.0.70/index.html",url:"/images/apps/xumo.png"},{displayName:"Bluetooth Audio",applicationType:"Lightning",uri:"https://rdkwiki.com/rdk-apps/BluetoothAudio/index.html",url:"/images/apps/netflix.png"},{displayName:"Test Prime video",applicationType:"",uri:"",url:"/images/apps/prime.png"}],Kt=[{displayName:"Fantasy-Island",url:"/images/tvShows/fantasy-island.jpg"},{displayName:"Onward",url:"/images/tvShows/onward.jpg"},{displayName:"Let it Snow",url:"/images/tvShows/let-it-snow.png"},{displayName:"Do Little",url:"/images/tvShows/do-little.jpg"},{displayName:"Summerland",url:"/images/tvShows/summerland.jpg"}],Wt=[{displayName:"Bluetooth",url:"/images/settings/bluetooth.jpg"},{displayName:"Wi-Fi",url:"/images/settings/wifi.jpg"}],Ht=[{title:"Apps",url:"/images/sidePanel/menu.png"},{title:"TV Shows",url:"/images/sidePanel/video.png"},{title:"Settings",url:"/images/sidePanel/settings.png"}],Jt=[{title:"DEFAULT",url:""},{title:"TATA",url:"http://35.154.217.235:8081/ "},{title:"EPAM",url:"https://px-apps.sys.comcast.net/lightning_apps/diagnostics/dist/index.html"}];class HomeApi{getAppListInfo(){return $t}getTVShowsInfo(){return Kt}getSettingsInfo(){return Wt}getSidePanelInfo(){return Ht}getUIInfo(){return Jt}}class HomeScreen extends g.Component{static _template(){return{Background:{w:1920,h:1080,src:c.asset("images/tvShows/background.jpg"),alpha:1},TopPanel:{type:TopPanel},SidePanel:{type:SidePanel},MainView:{type:MainView},Player:{type:AAMPVideoPlayer}}}_init(){this.homeApi=new HomeApi;var t=this.homeApi.getAppListInfo();var e=new window.URLSearchParams(window.location.search).get("data");console.log(e);var i=[],s=[];try{if(null!=e&&JSON.parse(e).hasOwnProperty("applications")){i=JSON.parse(e).applications;for(var a=0;a<i.length;a++)i[a].hasOwnProperty("displayName")&&i[a].hasOwnProperty("uri")&&i[a].hasOwnProperty("applicationType")&&i[a].hasOwnProperty("url")&&(s.push(i[a]));for(a=0;a<t.length;a++)s.push(t[a])}else s=t}catch(e){s=t,console.log("Query data is not proper: "+e)}this.tag("MainView").appItems=s,this.tag("MainView").tvShowItems=this.homeApi.getTVShowsInfo(),this.tag("MainView").settingsItems=this.homeApi.getSettingsInfo(),this.tag("SidePanel").sidePanelItems=this.homeApi.getSidePanelInfo(),this.sidePanelData=this.homeApi.getSidePanelInfo(),this._setState("SidePanel"),this.initialLoad=!0}_active(){if(this.initialLoad){let t=this;this._homeAnimation=t.animation({duration:.5,repeat:0,stopMethod:"immediate",actions:[{p:"scale",v:{0:5,1:1}},{p:"x",v:{0:-1920,1:0}},{p:"y",v:{0:-1080,1:0}}]}),this._homeAnimation.start(),this.initialLoad=!1}}play(){this.player=this.tag("Player");try{this.player.load({title:"Parkour event",subtitle:"m3u8",url:"https://bitdash-a.akamaihd.net/content/MI201109210084_1/m3u8s/f08e80da-bf1d-4e3d-8899-f0f6155f6efa.m3u8",drmConfig:null}),this.zoomOut(.1),this.hide(),this._setState("Playing"),this.player.setVideoRect(0,0,1920,1080)}catch(t){this._setState("MainView"),console.error("Playback Failed "+t)}}zoomIn(t){this._sidePanelAnimation=this.tag("SidePanel").animation({duration:t,repeat:0,stopMethod:"immediate",actions:[{p:"x",v:{0:130,1:280}}]}),this._sidePanelAnimation.start(),this.tag("SidePanel").resetSidePanelItems=this.sidePanelData;this._appAnimation=this.animation({duration:t,repeat:0,stopMethod:"immediate",actions:[{p:"x",v:{0:0,1:-320}},{p:"y",v:{0:0,1:-180}},{p:"scale",v:{0:1,1:1.17}}]}),this._appAnimation.start()}zoomOut(t){this._sidePanelAnimation=this.tag("SidePanel").animation({duration:t,repeat:0,stopMethod:"immediate",actions:[{p:"x",v:{0:280,1:130}}]}),this._sidePanelAnimation.start(),this.tag("SidePanel").sidePanelItems=this.sidePanelData;this._appAnimation=this.animation({duration:t,repeat:0,stopMethod:"immediate",actions:[{p:"x",v:{0:-320,1:0}},{p:"y",v:{0:-180,1:0}},{p:"scale",v:{0:1.17,1:1}}]}),this._appAnimation.start()}$goToSidePanel(t){this.zoomOut(.7),this.tag("SidePanel").index=t,this._setState("SidePanel")}$goToMainView(t){this.zoomIn(.7),this.tag("MainView").index=t,this._setState("MainView")}$goToPlayer(){this._setState("Player"),this.play()}hide(){this.tag("Background").patch({alpha:0}),this.tag("MainView").patch({alpha:0}),this.tag("TopPanel").patch({alpha:0}),this.tag("SidePanel").patch({alpha:0})}show(){this.tag("Background").patch({alpha:1}),this.tag("MainView").patch({alpha:1}),this.tag("TopPanel").patch({alpha:1}),this.tag("SidePanel").patch({alpha:1})}static _states(){return[class TopPanel extends(this){_getFocused(){return this.tag("TopPanel")}},class SidePanel extends(this){_getFocused(){return this.tag("SidePanel")}},class MainView extends(this){_getFocused(){return this.tag("MainView")}},class Playing extends(this){_getFocused(){return this.tag("Player")}_handleKey(t){77!=t.keyCode&&49!=t.keyCode&&36!=t.keyCode&&158!=t.keyCode||(this.zoomIn(0),this._setState("MainView"),this.player.stop(),this.show())}}]}}class BluetoothApi{constructor(){console.log("Bluetooth constructor"),this._events=new Map,this._devices=[],this._pairedDevices=[],this._connectedDevices=[]}activate(){return new Promise(((t,e)=>{this._thunder=thunderJS({host:"127.0.0.1",port:9998,default:1}),this.callsign="org.rdk.Bluetooth",this._thunder.call("Controller","activate",{callsign:this.callsign}).then((e=>{console.log("Bluetooth activated",e),this._thunder.on(this.callsign,"onDiscoveredDevice",(t=>{console.log("onDiscoveredDevice "+JSON.stringify(t)),this.getDiscoveredDevices().then((()=>{this._events.get("onDiscoveredDevice")(t)}))})),this._thunder.on(this.callsign,"onStatusChanged",(t=>{console.log("onStatusChanged "+t.newStatus),"PAIRING_CHANGE"===t.newStatus?this.getPairedDevices().then((()=>{this._events.get("onPairingChange")(t)})):"CONNECTION_CHANGE"===t.newStatus?this.getConnectedDevices().then((()=>{this._events.get("onConnectionChange")(t)})):"DISCOVERY_STARTED"===t.newStatus?this.getConnectedDevices().then((()=>{this._events.get("onDiscoveryStarted")()})):"DISCOVERY_COMPLETED"===t.newStatus&&this.getConnectedDevices().then((()=>{this._events.get("onDiscoveryCompleted")()}))})),this._thunder.on(this.callsign,"onPairingRequest",(t=>{console.log("onPairingRequest "+JSON.stringify(t)),this._events.get("onPairingRequest")(t)})),this._thunder.on(this.callsign,"onRequestFailed",(t=>{console.log("onRequestFailed "+JSON.stringify(t)),this._events.get("onRequestFailed")(t)})),this._thunder.on(this.callsign,"onConnectionRequest",(t=>{console.log("onConnectionRequest "+JSON.stringify(t)),this._events.get("onConnectionRequest")(t)})),t("Blutooth activated")})).catch((t=>{console.error("Activation failure",t),e("Bluetooth activation failed",t)}))}))}registerEvent(t,e){this._events.set(t,e)}deactivate(){this._events=new Map,this._thunder=null}disable(){return new Promise(((t,e)=>{this._thunder.call("org.rdk.Bluetooth","disable").then((e=>{console.log(JSON.stringify(e)),t(e)})).catch((t=>{console.error("Can't disable : "+t),e()}))}))}enable(){return new Promise(((t,e)=>{this._thunder.call("org.rdk.Bluetooth","enable").then((e=>{console.log(JSON.stringify(e)),t(e)})).catch((t=>{console.error("Can't enable : "+t),e()}))}))}startScan(){return new Promise(((t,e)=>{this._thunder.call("org.rdk.Bluetooth","startScan",{timeout:"10",profile:"KEYBOARD,MOUSE,JOYSTICK"}).then((i=>{console.log("scanning : "+i.success),i.success?t():e()})).catch((t=>{console.error("Error",t),e()}))}))}getDiscoveredDevices(){return new Promise(((t,e)=>{this._thunder.call("org.rdk.Bluetooth","getDiscoveredDevices").then((e=>{console.log(JSON.stringify(e)),this._devices=e.discoveredDevices,t(e.discoveredDevices)})).catch((t=>{console.error("Can't get discovered devices : "+t),e()}))}))}get discoveredDevices(){return this._devices}getPairedDevices(){return new Promise(((t,e)=>{this._thunder.call("org.rdk.Bluetooth","getPairedDevices").then((e=>{console.log(JSON.stringify(e)),this._pairedDevices=e.pairedDevices,t(e.pairedDevices)})).catch((t=>{console.error("Can't get paired devices : "+t),e()}))}))}get pairedDevices(){return this._pairedDevices}getConnectedDevices(){return new Promise(((t,e)=>{this._thunder.call("org.rdk.Bluetooth","getConnectedDevices").then((e=>{console.log(JSON.stringify(e)),this._connectedDevices=e.connectedDevices,t(e.connectedDevices)})).catch((t=>{console.error("Can't get connected devices : "+t),e()}))}))}get connectedDevices(){return this._connectedDevices}connect(t,e){return new Promise(((i,s)=>{console.log(t),this._thunder.call("org.rdk.Bluetooth","connect",{deviceID:t,deviceType:e,profile:e}).then((t=>{console.log("connected : "+t.success),i(t.success)})).catch((t=>{console.error("Connection failed",t),s()}))}))}disconnect(t,e){return console.log(t),new Promise(((i,s)=>{this._thunder.call("org.rdk.Bluetooth","disconnect",{deviceID:t,deviceType:e}).then((t=>{console.log("disconnected : "+t.success),t.success?i(!0):s()})).catch((t=>{console.error("disconnect failed",t),s()}))}))}unpair(t){return new Promise(((e,i)=>{this._thunder.call("org.rdk.Bluetooth","unpair",{deviceID:t}).then((t=>{console.log("unpaired : "+t.success),t.success?e():i()})).catch((t=>{console.error("unpair failed",t),i()}))}))}pair(t){return new Promise(((e,i)=>{this._thunder.call("org.rdk.Bluetooth","pair",{deviceID:t}).then((t=>{console.log("paired : "+t.success),t.success?e():i()})).catch((t=>{console.error("Error on pairing",t),i()}))}))}respondToEvent(t,e,i){return new Promise(((s,a)=>{this._thunder.call("org.rdk.Bluetooth","respondToEvent",{deviceID:t,eventType:e,responseValue:i}).then((t=>{console.log("responded to event : "+t.success),t.success?s():a()})).catch((t=>{console.error("Error on respondToEvent",t),a()}))}))}getName(){return new Promise(((t,e)=>{this._thunder.call("org.rdk.Bluetooth","getName").then((e=>{t(e.name)}))}))}}var Yt=4294967295,Xt=4294967295,qt=4290822336,Qt=4294967295;class Item extends g.Component{static _template(){return{Item:{w:200,h:65,rect:!0,color:qt,shader:{type:g.shaders.RoundedRectangle,radius:9}}}}set item(t){this._item=t,this.tag("Item").patch({Name:{x:100,y:32.5,mount:.5,text:{text:t.title,textColor:4294967295,fontSize:35}}})}set width(t){this.tag("Item").w=t}set height(t){this.tag("Item").h=t}_focus(){this.tag("Item").scale=1.1}_unfocus(){this.tag("Item").scale=1}}class SplashScreen extends g.Component{static _template(){return{Splashscreen:{w:1920,h:1080,alpha:0,Cache:{w:0,h:0,x:-1920,src:c.asset("images/tvShows/background.jpg")},Img:{mount:.5,x:960,y:540,src:c.asset("images/RDKLogo.png")}},SplashVideo:{w:1920,h:1080,alpha:0,Player:{type:AAMPVideoPlayer,w:1920,h:1080,x:0,y:0}},AutoRemotePair:{w:1920,h:1080,src:c.asset("images/tvShows/background.jpg"),alpha:0,Title:{w:1600,y:474,text:{fontSize:55,textAlign:"center",text:"Pair Your Remote",textColor:4294967295}},Description:{w:1300,y:550,x:150,text:{fontSize:35,textAlign:"center",maxLines:2,text:"Please put the remote in pairing mode, scanning will start in a minute",textColor:4293256677}},LoadingIcon:{x:750,y:600,alpha:0,src:c.asset("images/loading.png")},RemoteImg:{x:1300,y:300,src:c.asset("images/remote.png")}},ConnectivityScreen:{w:1920,h:1080,src:c.asset("images/tvShows/background.jpg"),alpha:0,Title:{w:1920,y:325,text:{fontSize:55,textAlign:"center",text:"You're not connected to the internet",textColor:4294967295}},Description:{w:1920,y:400,text:{fontSize:35,textAlign:"center",maxLines:2,text:"Please connect to either a wired connection or a WiFi Network, For WiFi network press home and then go to settings",wordWrapWidth:1400,textColor:4293256677}}},UISwitch:{w:1920,h:1080,src:c.asset("images/tvShows/background.jpg"),alpha:0,Title:{x:960,y:400,mountX:.5,text:{fontSize:55,textAlign:"center",text:"Choose your UI",textColor:4294967295}},UIList:{x:980,y:500,type:g.components.ListComponent,w:672,h:100,itemSize:224,roll:!0,mountX:.5}}}}_enable(){this.remotePaired=!0,this.hasInternet=!1,this._bt=new BluetoothApi,this._bt.activate(),this._bt.getPairedDevices().then((()=>this._bt.getConnectedDevices())).then((()=>{let t=this._bt.pairedDevices,e=this._bt.connectedDevices;0==t.length&&0==e.length&&(this.remotePaired=!1)})),(new AppApi).checkForInternet().then((t=>{this.hasInternet=t})),this._setState("Splashscreen")}_disable(){this._bt&&this._bt.deactivate(),this.player&&this.player.stop()}_init(){this.appApi=new AppApi;var t=new HomeApi;this.tag("UISwitch.UIList").items=t.getUIInfo().map(((t,e)=>({ref:"UI"+e,w:204,h:100,type:Item,item:t})))}startVideo(){this.player=this.tag("SplashVideo.Player");try{this.player.load({title:"",subtitle:"",image:"",url:"https://rdkwiki.com/rdk-apps/splash/splash.MOV",drmConfig:null})}catch(t){this.player=null,console.log("###########",t)}}static _states(){return[class Splashscreen extends(this){$enter(){this.tag("Splashscreen").animation({duration:.5,repeat:0,stopMethod:"immediate",actions:[{p:"alpha",v:{0:0,1:1}}]}).start(),this.screenTimeout=setTimeout((()=>{this._setState("SplashVideo")}),5e3)}_handleKey(t){83==t.keyCode&&this._setState("UISwitch")}$exit(){this.tag("Splashscreen").animation({duration:.5,repeat:0,stopMethod:"immediate",actions:[{p:"alpha",v:{0:1,1:0}}]}).start(),window.clearTimeout(this.screenTimeout)}},class SplashVideo extends(this){$enter(){this.tag("SplashVideo").animation({duration:.5,repeat:0,stopMethod:"immediate",actions:[{p:"alpha",v:{0:0,1:1}}]}).start(),this.startVideo(),this.timeout=setTimeout((()=>{0==this.remotePaired?this._setState("AutoRemotePair"):0==this.hasInternet?this._setState("ConnectivityScreen"):lt("home")}),5e3)}$exit(){const t=this.tag("SplashVideo").animation({duration:1,repeat:0,stopMethod:"immediate",actions:[{p:"alpha",v:{0:1,1:0}}]});t.on("finish",(t=>{this.player&&this.player.stop()})),t.start(),window.clearTimeout(this.timeout)}_handleKey(t){83==t.keyCode&&this._setState("UISwitch")}},class ConnectivityScreen extends(this){$enter(){this.tag("ConnectivityScreen").animation({duration:.5,repeat:0,stopMethod:"immediate",actions:[{p:"alpha",v:{0:0,1:1}},{p:"x",v:{0:1e3,1:0}}]}).start(),setTimeout((()=>{lt("home")}),5e3)}$exit(){this.tag("ConnectivityScreen").animation({duration:.5,repeat:0,stopMethod:"immediate",actions:[{p:"alpha",v:{0:1,1:0}}]}).start()}_handleKey(){lt("home")}},class AutoRemotePair extends(this){$enter(){const t=this.tag("AutoRemotePair").animation({duration:1,repeat:0,stopMethod:"immediate",actions:[{p:"alpha",v:{0:0,1:1}},{p:"x",v:{0:1e3,1:0}}]});var e=!1,i=setTimeout((()=>{e||(this.tag("AutoRemotePair.Description").text="Please put the remote in pairing mode, No Bluetooth device found"),setTimeout((()=>{0==this.hasInternet?this._setState("ConnectivityScreen"):lt("home")}),1e3)}),1e4),error=()=>{this.tag("AutoRemotePair.Description").text="Please put the remote in pairing mode, , No Bluetooth device found",setTimeout((()=>{0==this.hasInternet?this._setState("ConnectivityScreen"):lt("home")}),1e3)};t.start(),setTimeout((()=>{this.tag("AutoRemotePair.Description").text="Please put the remote in pairing mode, Scanning...";this.tag("AutoRemotePair.LoadingIcon").animation({duration:1,repeat:-1,stopMethod:"immediate",stopDelay:.2,actions:[{p:"rotation",v:{sm:0,0:0,1:2*Math.PI}}]}).play(),this.tag("AutoRemotePair.LoadingIcon").alpha=1,this._bt.startScan(),this._bt.registerEvent("onDiscoveredDevice",(()=>{let t=this._bt.discoveredDevices;t.length>0?this._bt.pair(t[0].deviceID):error()}))}),5e3),this._bt.registerEvent("onPairingChange",(()=>{let t=this._bt.pairedDevices;t.length>0?this._bt.connect(t[0].deviceID,t[0].deviceType):setTimeout((()=>{this._bt.getPairedDevices().then((()=>{let t=this._bt.pairedDevices;t.length>0?this._bt.connect(t[0].deviceID,t[0].deviceType):error()}))}),2e3)})),this._bt.registerEvent("onConnectionChange",(()=>{let t=this._bt.connectedDevices;t.length>0?(this.tag("AutoRemotePair.Description").text="Please put the remote in pairing mode, Connected to "+t[0].name,e=!0,clearTimeout(i),setTimeout((()=>{0==this.hasInternet?this._setState("ConnectivityScreen"):lt("home")}),2e3)):setTimeout((()=>{this._bt.getConnectedDevices().then((()=>{let t=this._bt.connectedDevices;t.length>0?(this.tag("AutoRemotePair.Description").text="Please put the remote in pairing mode, Connected to "+t[0].name,e=!0,clearTimeout(i),setTimeout((()=>{0==this.hasInternet?this._setState("ConnectivityScreen"):lt("home")}),2e3)):error()}))}),2e3)}))}$exit(){this.tag("AutoRemotePair").animation({duration:1,repeat:0,stopMethod:"immediate",actions:[{p:"alpha",v:{0:1,1:0}}]}).start()}},class UISwitch extends(this){$enter(){this.tag("UISwitch").animation({duration:.5,repeat:0,stopMethod:"immediate",actions:[{p:"alpha",v:{0:0,1:1}},{p:"x",v:{0:1e3,1:0}}]}).start()}_getFocused(){return this.tag("UISwitch.UIList").element}_handleRight(){if(this.tag("UISwitch.UIList").length-1!=this.tag("UISwitch.UIList").index)return this.tag("UISwitch.UIList").setNext(),this.tag("UISwitch.UIList").element}_handleLeft(){if(this.tag("UISwitch.UIList").index>0)return this.tag("UISwitch.UIList").setPrevious(),this.tag("UISwitch.UIList").element}_handleEnter(){"DEFAULT"!=this.tag("UISwitch.UIList").element._item.title?this.appApi.launchResident(this.tag("UISwitch.UIList").element._item.url):0==this.remotePaired?this._setState("AutoRemotePair"):0==this.hasInternet?this._setState("ConnectivityScreen"):lt("home")}$exit(){this.tag("UISwitch").animation({duration:1,repeat:0,stopMethod:"immediate",actions:[{p:"alpha",v:{0:1,1:0}}]}).start()}}]}}class SettingsItem extends g.Component{static _template(){return{Item:{w:570,h:65,rect:!0,color:0,shader:{type:g.shaders.RoundedRectangle,radius:9}}}}set item(t){this._item=t,this.tag("Item").patch({Left:{x:10,y:this.tag("Item").h/2,mountY:.5,text:{text:t,fontSize:25,textColor:Yt}}})}set width(t){this.tag("Item").w=t}set height(t){this.tag("Item").h=t}_focus(){this.tag("Item").color=qt}_unfocus(){this.tag("Item").color=0}}class BluetoothItem extends SettingsItem{static _template(){return{Item:{w:570,h:65,rect:!0,color:0,shader:{type:g.shaders.RoundedRectangle,radius:9}}}}set item(t){this._item=t,this.connected=t.connected?"Connected":"Not Connected",this.status=t.paired?this.connected:"Not Paired",this.tag("Item").patch({Left:{x:10,y:32.5,mountY:.5,text:{text:t.name,fontSize:25,textColor:Yt}},Right:{x:560,mountX:1,y:32.5,mountY:.5,flex:{direction:"row"},Text:{x:0,flexItem:{},text:{text:this.status,fontSize:25}},Info:{color:4278190335,flexItem:{marginLeft:10},texture:g.Tools.getSvgTexture(c.asset("images/info.png"),32.5,32.5)}}}),"Connected"==this.status?this.tag("Item.Right.Info").visible=!1:this.tag("Item.Right.Info").visible=!0}_focus(){this.tag("Item").color=qt}_unfocus(){this.tag("Item").color=0}}class BluetoothPairingScreen extends g.Component{static _template(){return{PairingScreen:{x:0,y:0,w:640,h:1080,rect:!0,color:4281747025},Title:{x:20,y:100,text:{text:"",fontSize:30,textColor:Xt}},List:{x:20,y:150,type:g.components.ListComponent,w:640,h:400,itemSize:65,horizontal:!1,invertDirection:!0,roll:!0},Status:{x:20,y:500,Text:{text:{text:"Enter the below code in your Bluetooth device and press enter",wordWrapWidth:570,fontSize:30}},Code:{x:0,y:60,text:{text:""}},visible:!1}}}set item(t){this.tag("Status").visible=!1,this.tag("Title").text=t.name;var e=[];this._item=t,e=t.paired?t.connected?["Disconnect","Unpair","Cancel"]:["Connect","Unpair","Cancel"]:["Pair","Cancel"],this.tag("List").items=e.map(((t,e)=>({ref:t,w:640,h:65,type:SettingsItem,item:t})))}set code(t){this.tag("Status.Code").text.text=t,this.tag("Status").visible=!0}_getFocused(){return this.tag("List").element}_handleDown(){this.tag("List").setNext()}_handleUp(){this.tag("List").setPrevious()}_handleEnter(){this.fireAncestors("$pressEnter",this.tag("List").element.ref)}}class BluetoothScreen extends g.Component{static _template(){return{Title:{x:1600,y:50,text:{text:"Bluetooth",textColor:Qt},mountX:.5},Switch:{x:1300,y:150,rect:!0,shader:{type:g.shaders.RoundedRectangle,radius:9},color:12632256,w:570,h:50,Text:{x:0,text:{text:"Bluetooth",textColor:Xt}},Button:{x:560,y:10,mountX:1,src:c.asset("images/switch-on.png")}},Name:{x:1300,y:200,text:{text:"Now discoverable as",textColor:Yt,fontSize:20}},Networks:{x:1280,y:250,flex:{direction:"column"},PairedNetworks:{flexItem:{margin:20},w:640,h:30,Title:{text:{text:"My Devices",textColor:Xt,fontSize:30}},List:{x:0,y:65,type:g.components.ListComponent,w:640,itemSize:65,horizontal:!1,invertDirection:!0,roll:!0}},AvailableNetworks:{flexItem:{margin:20,marginTop:30},w:640,h:30,Title:{text:{text:"Other Devices",textColor:Xt,fontSize:30}},Loader:{x:250,y:-10,w:50,h:50,color:4278190080,src:c.asset("images/loader.png"),visible:!1},List:{x:0,y:65,w:640,h:100,type:g.components.ListComponent,itemSize:65,horizontal:!1,invertDirection:!0,roll:!0}},visible:!1},PairingScreen:{x:1280,y:0,w:640,h:1080,visible:!1,type:BluetoothPairingScreen},Message:{x:1320,y:950,text:{text:""}}}}_init(){this.loadingAnimation=this.tag("Networks.AvailableNetworks.Loader").animation({duration:1,repeat:-1,stopMethod:"immediate",stopDelay:.2,actions:[{p:"rotation",v:{sm:0,0:0,1:2*Math.PI}}]}),this.loadingAnimation.play(),this._bt=new BluetoothApi,this._bluetooth=!0,this._activateBluetooth(),this._setState("Switch"),this._bluetooth=!0,this._bluetooth&&(this.tag("Networks").visible=!0),this._pairedNetworks=this.tag("Networks.PairedNetworks"),this._availableNetworks=this.tag("Networks.AvailableNetworks"),this.renderDeviceList()}_enable(){this._bluetooth&&this._bt.startScan(),this.scanTimer=setInterval((()=>{this._bluetooth&&this._bt.startScan()}),15e3)}_disable(){clearInterval(this.scanTimer)}renderDeviceList(){this._bt.getPairedDevices().then((t=>{this._pairedList=t,this._pairedNetworks.h=65*this._pairedList.length+30,this._pairedNetworks.tag("List").h=65*this._pairedList.length,this._pairedNetworks.tag("List").items=this._pairedList.map(((t,e)=>(t.paired=!0,{ref:"Paired"+e,w:640,h:65,type:BluetoothItem,item:t})))})),this._bt.getDiscoveredDevices().then((t=>{this._discoveredList=t,this._otherList=this._discoveredList.filter((e=>{if(!e.paired)return!(t=this._pairedList.map((t=>t.deviceID))).includes(e.deviceID)&&e})),this._availableNetworks.h=65*this._otherList.length+30,this._availableNetworks.tag("List").h=65*this._otherList.length,this._availableNetworks.tag("List").items=this._otherList.map(((t,e)=>({ref:"Other"+e,w:640,h:65,type:BluetoothItem,item:t})))}))}static _states(){return[class Switch extends(this){$enter(){this.tag("Switch").color=qt}$exit(){this.tag("Switch").color=12632256}_handleDown(){this._bluetooth&&(this._pairedNetworks.tag("List").length>0?this._setState("PairedDevices"):this._availableNetworks.tag("List").length>0&&this._setState("AvailableDevices"))}_handleEnter(){this.switch()}},class PairedDevices extends(this){$enter(){}_getFocused(){return this._pairedNetworks.tag("List").element}_handleDown(){this._navigate("MyDevices","down")}_handleUp(){this._navigate("MyDevices","up")}_handleEnter(){this.tag("PairingScreen").visible=!0,this.tag("PairingScreen").item=this._pairedNetworks.tag("List").element._item,this._setState("PairingScreen")}},class AvailableDevices extends(this){$enter(){}_getFocused(){return this._availableNetworks.tag("List").element}_handleDown(){this._navigate("AvailableDevices","down")}_handleUp(){this._navigate("AvailableDevices","up")}_handleEnter(){this.tag("PairingScreen").visible=!0,this.tag("PairingScreen").item=this._availableNetworks.tag("List").element._item,this._setState("PairingScreen")}},class PairingScreen extends(this){_getFocused(){return this.tag("PairingScreen")}$pressEnter(t){"Cancel"===t?this._setState("Switch"):"Pair"===t?this._bt.pair(this._availableNetworks.tag("List").element._item.deviceID).then((()=>{})):"Connect"===t?this._bt.connect(this._pairedNetworks.tag("List").element._item.deviceID,this._pairedNetworks.tag("List").element._item.deviceType).then((t=>{t||(this.tag("Message").text="CONNECTION FAILED",this._setState("Switch")),setTimeout((()=>{this.tag("Message").text=""}),2e3)})):"Disconnect"===t?(this._bt.disconnect(this._pairedNetworks.tag("List").element._item.deviceID,this._pairedNetworks.tag("List").element._item.deviceType).then((()=>{})),this._setState("Switch")):"Unpair"===t&&(this._bt.unpair(this._pairedNetworks.tag("List").element._item.deviceID).then((()=>{})),this._setState("Switch"))}$exit(){this.tag("PairingScreen").visible=!1}}]}_navigate(t,e){let i;"MyDevices"===t?i=this._pairedNetworks.tag("List"):"AvailableDevices"===t&&(i=this._availableNetworks.tag("List")),"down"===e?i.index<i.length-1?i.setNext():i.index==i.length-1&&"MyDevices"===t&&this._availableNetworks.tag("List").length>0&&this._setState("AvailableDevices"):"up"===e&&(i.index>0?i.setPrevious():0==i.index&&("AvailableDevices"===t&&this._pairedNetworks.tag("List").length>0?this._setState("PairedDevices"):this._setState("Switch")))}switch(){this._bluetooth?this._bt.disable().then((t=>{t.success&&(this._bluetooth=!1,this.tag("Networks").visible=!1,this.tag("Switch.Button").src=c.asset("images/switch-off.png"))})):this._bt.enable().then((t=>{t.success&&(this._bluetooth=!0,this.tag("Networks").visible=!0,this.tag("Switch.Button").src=c.asset("images/switch-on.png"),this.renderDeviceList(),this._bt.startScan())}))}_activateBluetooth(){this._bt.activate().then((()=>{this._bt.registerEvent("onDiscoveredDevice",(()=>{this.renderDeviceList()})),this._bt.registerEvent("onPairingChange",(t=>{this._bt.startScan(),this.renderDeviceList(),this._setState("Switch")})),this._bt.registerEvent("onPairingRequest",(t=>{"true"===t.pinRequired&&t.pinValue?this.tag("PairingScreen").code=t.pinValue:this.respondToPairingRequest(t.deviceID,"ACCEPTED")})),this._bt.registerEvent("onConnectionChange",(t=>{this._bt.startScan(),console.log("CONNECTION CHANGED"+JSON.stringify(t)),this.renderDeviceList(),this._setState("Switch"),t.connected?this.tag("Message").text="CONNECTION SUCCESS":this.tag("Message").text="CONNECTION FAILED",setTimeout((()=>{this.tag("Message").text=""}),2e3)})),this._bt.registerEvent("onDiscoveryCompleted",(()=>{this.tag("Networks.AvailableNetworks.Loader").visible=!1,this.renderDeviceList()})),this._bt.registerEvent("onDiscoveryStarted",(()=>{this.tag("Networks.AvailableNetworks.Loader").visible=!0})),this._bt.registerEvent("onRequestFailed",(t=>{this._bt.startScan(),this.renderDeviceList(),this._setState("Switch"),this.tag("Message").text=t.newStatus,setTimeout((()=>{this.tag("Message").text=""}),2e3)})),this._bt.getName().then((t=>{this.tag("Name").text.text=`Now discoverable as "${t}"`}))}))}respondToPairingRequest(t,e){this._bt.respondToEvent(t,"onPairingRequest",e)}}class WiFiItem extends SettingsItem{static _template(){return{Item:{w:570,h:65,rect:!0,color:0,shader:{type:g.shaders.RoundedRectangle,radius:9}}}}set item(t){this._item=t,this.status=t.connected?"Connected":"Not Connected",this.tag("Item").patch({Left:{x:10,y:32.5,mountY:.5,text:{text:t.ssid,fontSize:25,textColor:Yt}},Right:{x:560,mountX:1,y:32.5,mountY:.5,flex:{direction:"row"},Lock:{color:4278190080,flexItem:{marginLeft:10},texture:g.Tools.getSvgTexture(c.asset("images/wifi-lock.png"),32.5,32.5)},Icon:{color:4278190080,flexItem:{marginLeft:10},texture:g.Tools.getSvgTexture(c.asset("images/wifi-icon.png"),32.5,32.5)},Info:{color:4278190080,flexItem:{marginLeft:10},texture:g.Tools.getSvgTexture(c.asset("images/info.png"),32.5,32.5)}}}),"0"==t.security||"15"==t.security?this.tag("Item.Right.Lock").visible=!1:this.tag("Item.Right.Lock").visible=!0}_focus(){this.tag("Item").color=qt}_unfocus(){this.tag("Item").color=0}}const Gt=1;class Wifi{constructor(){this._events=new Map}activate(){return new Promise(((t,e)=>{this._thunder=thunderJS({host:"127.0.0.1",port:9998,default:1}),this.callsign="org.rdk.Wifi",this._thunder.call("Controller","activate",{callsign:"org.rdk.Network"}).then((t=>{this._thunder.on("org.rdk.Network","onIPAddressStatusChanged",(t=>{this._events.has("onIPAddressStatusChanged")&&this._events.get("onIPAddressStatusChanged")(t)}))})),this._thunder.call("Controller","activate",{callsign:this.callsign}).then((e=>{console.log("Wifi activated",e),this.getCurrentState().then((t=>{t===Gt&&this.setEnabled(!0)})),this._thunder.on(this.callsign,"onWIFIStateChanged",(t=>{console.log("onWIFIStateChanged: "+t.state),this._events.has("onWIFIStateChanged")&&this._events.get("onWIFIStateChanged")(t)})),this._thunder.on(this.callsign,"onError",(t=>{console.log("Error: "+t),this._events.has("onError")&&this._events.get("onError")(t)})),this._thunder.on(this.callsign,"onAvailableSSIDs",(t=>{console.log("AvailableSSIDs: "+JSON.stringify(t)),!1===t.moreData&&(this.stopScan(),t.ssids=t.ssids.filter(((e,i)=>t.ssids.findIndex((t=>t.ssid===e.ssid))===i)),this._events.has("onAvailableSSIDs")&&this._events.get("onAvailableSSIDs")(t))})),t(e)})).catch((t=>{console.error("Wifi activation failed: "+t),e(t)}))}))}registerEvent(t,e){this._events.set(t,e)}deactivate(){this._events=new Map,this._thunder=null}getConnectedSSID(){return new Promise(((t,e)=>{this._thunder.call(this.callsign,"getConnectedSSID").then((e=>{console.log("ConnectedSSID: "+e.ssid),t(e)})).catch((t=>{console.error("getConnectedSSID fail: "+t),e(t)}))}))}discoverSSIDs(){return new Promise(((t,e)=>{this._thunder.call(this.callsign,"startScan",{incremental:!1,ssid:"",frequency:""}).then((e=>{console.log("startScan success"),t(e)})).catch((t=>{console.error("startScan fail: "+t),e(t)}))}))}stopScan(){return new Promise(((t,e)=>{this._thunder.call(this.callsign,"stopScan").then((e=>{console.log("stopScan success"),t(e)})).catch((t=>{console.error("stopScan fail: "+t),e(t)}))}))}connect(t,e){return new Promise(((i,s)=>{this.disconnect().then((()=>{console.log("connect SSID "+t.ssid),this._thunder.call(this.callsign,"connect",{ssid:t.ssid,passphrase:e,securityMode:t.security}).then((e=>{console.log("connected SSID "+t.ssid),i(e)})).catch((t=>{console.error("Connection failed: "+t),s(t)}))}),s)}))}disconnect(){return new Promise(((t,e)=>{this._thunder.call(this.callsign,"disconnect",{}).then((e=>{console.log("WiFi disconnected: "+JSON.stringify(e)),t(e)}),(t=>{console.error("Can't disconnect WiFi: "+t),e(t)}))}))}getCurrentState(){return new Promise(((t,e)=>{this._thunder.call(this.callsign,"getCurrentState").then((e=>{console.log("WiFi state: "+e.state),t(e.state)})).catch((t=>{console.error("Can't get WiFi state: "+t),e(t)}))}))}setEnabled(t){return new Promise(((e,i)=>{this._thunder.call(this.callsign,"setEnabled",{enable:t}).then((t=>{e(t)})).catch((t=>{i(t)}))}))}getPaired(){return new Promise(((t,e)=>{this._thunder.call(this.callsign,"getPairedSSID",{}).then((e=>{t(e)})).catch((t=>{console.error("Can't get paired: "+t),e(t)}))}))}getDefaultInterface(){return new Promise(((t,e)=>{this._thunder.call("org.rdk.Network","getDefaultInterface",{}).then((e=>{t(e)})).catch((t=>{e(t)}))}))}setInterface(t,e){return new Promise(((i,s)=>{this._thunder.call("org.rdk.Network","setInterfaceEnabled",{interface:t,persist:!0,enabled:e}).then((t=>{i(t)})).catch((t=>{s(t)}))}))}setDefaultInterface(t,e){return new Promise(((i,s)=>{this._thunder.call("org.rdk.Network","setDefaultInterface",{interface:t,persist:e}).then((t=>{i(t)})).catch((t=>{s(t)}))}))}}class Keypad extends g.Component{static _template(){return{Wrapper:{flex:{direction:"row"}}}}set items(t){this._scroll=!0,this.tag("Wrapper").children=t,this._index=0,t.length>0?this._setState("Filled"):this._setState("Empty")}set wrap(t){if(t){let t=this.tag("Wrapper");t.w=428,t.h=56,this.tag("Wrapper").patch({flex:{direction:"row",wrap:!0}})}this._wrap=!0}get items(){return this.tag("Wrapper").children}get currentItem(){return this.items[this._index]}get length(){return this.items.length}set orientation(t){this._orientation=t,"horizontal"===t?this.tag("Wrapper").patch({flex:{direction:"row"}}):this.tag("Wrapper").patch({flex:{direction:"column"}})}get orientation(){return this._orientation||"horizontal"}set jump(t){this._jump=t}get jump(){return this._jump||!1}set jumpToStart(t){this._jumpToStart=t}get jumpToStart(){return void 0!==this._jumpToStart?this._jumpToStart:this.jump}set jumpToEnd(t){this._jumpToEnd=t}get jumpToEnd(){return void 0!==this._jumpToEnd?this._jumpToEnd:this.jump}_navigate(t){this._prevY=this.currentItem.finalY;this.orientation;if("right"===t||"left"===t||"up"===t||"down"===t){const e=this.items.length,i=this._index;let s=i+1;if(("left"===t||"up"===t&&!1===this._wrap)&&(s=i-1),"up"===t&&!0===this._wrap){let t=Math.floor(this.tag("Wrapper").w/this.currentItem.finalW),e=i-t;s=i-t>=0?e:-1}if("down"===t&&!0===this._wrap){let t=i+Math.floor(this.tag("Wrapper").w/this.currentItem.finalW);if(s=t<e?t:-1,-1==s)return this.fireAncestors("$listEnd")}if(s<0)return this.fireAncestors("$listStart");if(s>-1&&s<e)this._index=s;else{if(!(this.jump||this.jumpToStart||this.jumpToEnd))return!1;s<0&&this.jumpToEnd?this._index=s+e:s===e&&this.jumpToStart&&(this._index=0)}i!==this._index&&this.indexChanged({index:this._index,previousIndex:i})}}setIndex(t){if(t>-1&&t<this.items.length){const e=this._index;this._index=t,this.indexChanged({index:this._index,previousIndex:e})}}indexChanged(t){this.signal("indexChanged",t)}_getFocused(){return this}_construct(){this._index=0}_init(){this._setState("Empty")}static _states(){return[class Empty extends(this){},class Filled extends(this){_getFocused(){return this.currentItem}_handleRight(){return this._navigate("right")}_handleLeft(){return this._navigate("left")}_handleUp(){return this._navigate("up")}_handleDown(){return this._navigate("down")}}]}}class Key extends g.Component{_construct(){this._keyType="alphanum",this._fontSize=36}static _template(){return{Border:{w:this.width,h:this.height,type:g.components.BorderComponent,colorBorder:4278190080}}}set item(t){this._key=t,this.tag("Border").w=this.w,this.tag("Border").h=this.h,this.tag("Border").colorBorder=4278190080,this.tag("Border").content={Focus:{rect:!0,w:this.w,h:this.h,color:12632256},Key:{x:this.w/2,y:this.h/2,mount:.5,text:{text:t,fontSize:this._fontSize,fontFace:"Light"}}},"delete"==this._keyType&&(this.tag("Border").content={Key:{src:c.asset("images/del.png"),zIndex:10}})}set keyType(t){this._keyType=t}set fontSize(t){this._fontSize=t}_focus(){this.tag("Border").content={Focus:{color:4290822336},Key:{color:4278190080}},this.tag("Border").colorBorder=4290822336}_unfocus(){this.tag("Border").content={Focus:{color:12632256},Key:{color:4294967295}},this.tag("Border").colorBorder=4278190080}_handleEnter(){this.fireAncestors("$pressedKey",this._key,this._keyType)}}class KeyDetails{getAlphabet(){return"abcdefghijklmnopqrstuvwxyz  ".split("")}getSymbols(){return"1234567890+/:;()$$@\"'.,?!#*-".split("")}}class SelectionKey extends Key{set item(t){this._key=t}_init(){this._arr=[[25,0,0,25],[0,0,0,0],[0,25,25,0]],this.patch({Bg:{x:0,y:0,texture:g.Tools.getRoundRect(143,53,this._arr[this._keyType],1,4278190080,!0,0)},Text:{x:this.w/2,y:this.h/2,mount:.5,text:{text:this._key,fontSize:24,textColor:4294967295,fontFace:"Regular"}}})}_focus(){this.tag("Text").text.fontStyle="Bold",this.tag("Text").text.textColor=4278190080,this.patch({Bg:{x:0,y:0,texture:g.Tools.getRoundRect(143,56,this._arr[this._keyType],0,4290822336,!0,4290822336)}})}_unfocus(){this.tag("Text").text.fontStyle="normal",this.tag("Text").text.textColor=4294967295,this.patch({Bg:{x:0,y:0,texture:g.Tools.getRoundRect(143,53,this._arr[this._keyType],1,4278190080,!0,0)}})}}class WiFiPasswordScreen extends g.Component{_construct(){this._width=428,this._height=56,this._radius=28,this._strokeWidth=2,this.keySpace=5}static _template(){return{}}_init(){this._api=new KeyDetails,this.patch({src:c.asset("images/tvShows/background.jpg"),w:440,h:560,Entry:{x:4,y:10,texture:g.Tools.getRoundRect(this._width,this._height,this._radius,this._strokeWidth,4279966491,!0,10855845),Text:{x:20,y:this._height/2+5,mountY:.5,text:{text:"Password",fontSize:18,fontFace:"Light",textColor:4289045925}},Pwd:{x:130,y:this._height/2+5,mountY:.5,text:{text:"",fontSize:24,fontFace:"Light",textColor:4290822336,wordWrapWidth:this._width-130,wordWrap:!1,textOverflow:"ellipsis"}}},Selection:{x:4,y:this._height+21,texture:g.Tools.getRoundRect(this._width,this._height,this._radius,this._strokeWidth,1776411,!0,10855845),Types:{type:g.components.ListComponent,itemSize:143,w:this._width,h:this._height,clipping:!0,roll:!0,zIndex:10}},Keypad:{x:9,y:2*(this._height+21),w:this._width,wrap:!0,type:Keypad},FunctionalKeys:{x:9,y:5*(this._height+21)+15,w:this._width,wrap:!0,type:Keypad},Submit:{x:4,y:5*(this._height+21)+15+61,texture:g.Tools.getRoundRect(this._width,this._height,this._radius,this._strokeWidth,4279966491,!0,10855845),Text:{x:this._width/2,y:this._height/2,mount:.5,text:{text:"Submit",fontSize:24,fontFace:"Light",textColor:4294967295}}}}),this.setKeypad("abc");let t={ref:"Keyclear",w:117,h:56,type:Key,fontSize:24,item:"CLEAR",keyType:"clear",flexItem:{marginRight:5,marginBottom:5}},e={ref:"Keyspace",w:178,h:56,type:Key,fontSize:24,item:"Space",keyType:"space",flexItem:{marginRight:5,marginBottom:5}},i={ref:"Keydel",w:117,h:56,keyType:"delete",type:Key,fontSize:24,item:"",flexItem:{marginRight:5,marginBottom:5}};this.tag("FunctionalKeys").items=[t,e,i],this.tag("Selection.Types").items=["abc","ABC","#+-"].map(((t,e)=>({ref:"Item",w:this._width/3,h:this._height,fontSize:24,keyType:e,item:t,type:SelectionKey,clipping:!0})))}_active(){this.tag("Selection.Types").start(),this._setState("Selection")}_inactive(){this.tag("Entry.Pwd").text.text=""}$pressedKey(t,e){console.log(t);let i=this.tag("Entry.Pwd");"alphanum"===e?i.text.text=i.text.text+t:"clear"===e?i.text.text="":"space"===e?i.text.text=i.text.text+" ":"delete"===e&&(i.text.text=i.text.text.substring(0,i.text.text.length-1))}setKeypad(t){let e=[];"abc"===t?e=this._api.getAlphabet():"#+-"===t?e=this._api.getSymbols():"ABC"===t&&(e=this._api.getAlphabet().map((t=>t.toUpperCase()))),this.tag("Keypad").items=[],this.tag("Keypad").items=e.map((t=>({ref:"Key"+t,w:56,h:56,type:Key,item:t,flexItem:{marginRight:5,marginBottom:5}})))}static _states(){return[class Selection extends(this){$enter(){this.setKeypad(this.tag("Selection.Types").element._key)}_getFocused(){return this.tag("Selection.Types").element}_handleRight(){this.tag("Selection.Types").index<this.tag("Selection.Types").length-1&&(this.tag("Selection.Types").setNext(),this.setKeypad(this.tag("Selection.Types").element._key))}_handleLeft(){0!=this.tag("Selection.Types").index&&(this.tag("Selection.Types").setPrevious(),this.setKeypad(this.tag("Selection.Types").element._key))}_handleDown(){this._setState("Keypad")}},class Keypad extends(this){_getFocused(){return this.tag("Keypad")}$listEnd(){this._setState("Function")}$listStart(){this._setState("Selection")}},class Function extends(this){_getFocused(){return this.tag("FunctionalKeys")}_handleUp(){this._setState("Keypad")}$listEnd(){console.log("down"),this._setState("Submit")}$listStart(){this._setState("Keypad")}},class Submit extends(this){$enter(){this.patch({Submit:{x:0,y:5*(this._height+21)+15+61,texture:g.Tools.getRoundRect(this._width,this._height,this._radius,this._strokeWidth,12632256,!0,4290822336)}}),this.tag("Submit.Text").text.textColor=4278190080}$exit(){this.patch({Submit:{x:0,y:5*(this._height+21)+15+61,texture:g.Tools.getRoundRect(this._width,this._height,this._radius,this._strokeWidth,4279966491,!0,12632256)}}),this.tag("Submit.Text").text.textColor=4294967295}_handleEnter(){this.fireAncestors("$password",this.tag("Entry.Pwd").text.text)}_handleUp(){console.log("Up"),this._setState("Function")}_handleLeft(){this._setState("Function")}}]}}class BluetoothPairingScreen$1 extends g.Component{static _template(){return{PairingScreen:{x:0,y:0,w:640,h:1080,rect:!0,color:4281747025},Title:{x:20,y:100,text:{text:"",fontSize:30,textColor:Xt}},List:{x:20,y:150,type:g.components.ListComponent,w:640,h:400,itemSize:65,horizontal:!1,invertDirection:!0,roll:!0},Password:{type:WiFiPasswordScreen,x:320,y:350,mountX:.5,w:428,h:56,alpha:0}}}set item(t){this.tag("Title").text=t.ssid;var e=[];this._item=t,e=t.connected?["Disconnect","Cancel"]:["Connect","Cancel"],this.tag("List").items=e.map(((t,e)=>({ref:t,w:640,h:65,type:SettingsItem,item:t}))),this._setState("Pair")}static _states(){return[class Password extends(this){$enter(){this.tag("Password").alpha=1}_getFocused(){return this.tag("Password")}$password(t){this.fireAncestors("$startConnect",t)}$exit(){this.tag("Password").alpha=0}_handleKey(t){27!=t.keyCode&&77!=t.keyCode||this._setState("Pair")}},class Pair extends(this){$enter(){}_getFocused(){return this.tag("List").element}_handleDown(){this.tag("List").setNext()}_handleUp(){this.tag("List").setPrevious()}_handleEnter(){"Connect"==this.tag("List").element.ref&&"0"!=this._item.security?this._setState("Password"):this.fireAncestors("$pressEnter",this.tag("List").element.ref)}}]}}class WiFiScreen extends g.Component{static _template(){return{Title:{x:1600,y:50,text:{text:"Wi-Fi",textColor:Qt},mountX:.5},Switch:{x:1300,y:150,rect:!0,shader:{type:g.shaders.RoundedRectangle,radius:9},color:12632256,w:570,h:50,Text:{x:0,text:{text:"Wi-Fi",textColor:Xt}},Button:{x:560,y:10,mountX:1,src:c.asset("images/switch-off.png")}},Networks:{x:1280,y:250,flex:{direction:"column"},PairedNetworks:{flexItem:{margin:20},w:640,h:30,Title:{text:{text:"My Network",textColor:Xt,fontSize:30}},List:{x:0,y:65,type:g.components.ListComponent,w:640,itemSize:65,horizontal:!1,invertDirection:!0,roll:!0}},AvailableNetworks:{flexItem:{margin:20,marginTop:30},w:640,h:30,Title:{text:{text:"Other Networks",textColor:Xt,fontSize:30}},Loader:{x:250,y:-10,w:50,h:50,color:4278190080,src:c.asset("images/loader.png"),visible:!1},List:{x:0,y:65,w:640,h:100,type:g.components.ListComponent,itemSize:65,horizontal:!1,invertDirection:!0,roll:!0}},visible:!1},PairingScreen:{x:1280,y:0,w:640,h:1080,visible:!1,type:BluetoothPairingScreen$1},IpAddress:{x:1820,y:920,mountX:1,mountY:0,text:{text:"IP:NA",textColor:Xt,fontSize:30}}}}_init(){this.loadingAnimation=this.tag("Networks.AvailableNetworks.Loader").animation({duration:1,repeat:-1,stopMethod:"immediate",stopDelay:.2,actions:[{p:"rotation",v:{sm:0,0:0,1:2*Math.PI}}]}),this.loadingAnimation.play(),this._wifi=new Wifi,this.wifiStatus=!1,this._activateWiFi(),this._setState("Switch"),this.wiFiStatus&&(this.tag("Networks").visible=!0),this._pairedNetworks=this.tag("Networks.PairedNetworks"),this._availableNetworks=this.tag("Networks.AvailableNetworks");thunderJS({host:"127.0.0.1",port:9998,default:1}).Controller.activate({callsign:"org.rdk.System"}).then((()=>{this.displayIp()})).catch((t=>{console.log("System Error",t)})),this._wifi.registerEvent("onIPAddressStatusChanged",(t=>{"ACQUIRED"==t.status?this.tag("IpAddress").text.text="IP:"+t.ip4Address:"LOST"==t.status&&(this.tag("IpAddress").text.text="IP:NA")}))}displayIp(){thunderJS({host:"127.0.0.1",port:9998,default:1}).call("org.rdk.System","getDeviceInfo",{params:"estb_ip"}).then((t=>{this.tag("IpAddress").text.text="IP:"+t.estb_ip})).catch((t=>{console.log("IpAddress Error",t)}))}_enable(){this.wifiStatus&&(this._wifi.discoverSSIDs(),this.tag("Networks.AvailableNetworks.Loader").visible=!0),this.scanTimer=setInterval((()=>{this.wifiStatus&&(this._wifi.discoverSSIDs(),this.tag("Networks.AvailableNetworks.Loader").visible=!0)}),5e3)}_disable(){clearInterval(this.scanTimer)}renderDeviceList(t){this._wifi.getConnectedSSID().then((e=>{""!=e.ssid?this._pairedList=[e]:this._pairedList=[],this._pairedNetworks.h=65*this._pairedList.length+30,this._pairedNetworks.tag("List").h=65*this._pairedList.length,this._pairedNetworks.tag("List").items=this._pairedList.map(((t,e)=>(t.connected=!0,{ref:"Paired"+e,w:640,h:65,type:WiFiItem,item:t}))),this._otherList=t.filter((t=>!(e=this._pairedList.map((t=>t.ssid))).includes(t.ssid)&&t)),this._availableNetworks.h=65*this._otherList.length+30,this._availableNetworks.tag("List").h=65*this._otherList.length,this._availableNetworks.tag("List").items=this._otherList.map(((t,e)=>(t.connected=!1,{ref:"Other"+e,w:640,h:65,type:WiFiItem,item:t})))}))}static _states(){return[class Switch extends(this){$enter(){this.tag("Switch").color=qt}$exit(){this.tag("Switch").color=12632256}_handleDown(){this.wifiStatus&&(this._pairedNetworks.tag("List").length>0?this._setState("PairedDevices"):this._availableNetworks.tag("List").length>0&&this._setState("AvailableDevices"))}_handleEnter(){this.switch()}},class PairedDevices extends(this){$enter(){}_getFocused(){return this._pairedNetworks.tag("List").element}_handleDown(){this._navigate("MyDevices","down")}_handleUp(){this._navigate("MyDevices","up")}_handleEnter(){this.tag("PairingScreen").visible=!0,this.tag("PairingScreen").item=this._pairedNetworks.tag("List").element._item,this._setState("PairingScreen")}},class AvailableDevices extends(this){$enter(){}_getFocused(){return this._availableNetworks.tag("List").element}_handleDown(){this._navigate("AvailableDevices","down")}_handleUp(){this._navigate("AvailableDevices","up")}_handleEnter(){this.tag("PairingScreen").visible=!0,this.tag("PairingScreen").item=this._availableNetworks.tag("List").element._item,this._setState("PairingScreen")}},class PairingScreen extends(this){_getFocused(){return this.tag("PairingScreen")}$pressEnter(t){"Cancel"===t?this._setState("Switch"):"Connect"===t?this._wifi.connect(this._availableNetworks.tag("List").element._item,"").then((()=>{})):"Disconnect"===t&&(this._wifi.disconnect().then((()=>{})),this._setState("Switch"))}$startConnect(t){this._wifi.connect(this._availableNetworks.tag("List").element._item,t)}$exit(){this.tag("PairingScreen").visible=!1}}]}_navigate(t,e){let i;"MyDevices"===t?i=this._pairedNetworks.tag("List"):"AvailableDevices"===t&&(i=this._availableNetworks.tag("List")),"down"===e?i.index<i.length-1?i.setNext():i.index==i.length-1&&"MyDevices"===t&&this._availableNetworks.tag("List").length>0&&this._setState("AvailableDevices"):"up"===e&&(i.index>0?i.setPrevious():0==i.index&&("AvailableDevices"===t&&this._pairedNetworks.tag("List").length>0?this._setState("PairedDevices"):this._setState("Switch")))}switch(){this.wifiStatus?this._wifi.setInterface("ETHERNET",!0).then((t=>{t.success&&this._wifi.setDefaultInterface("ETHERNET",!0).then((t=>{t.success&&(this._wifi.disconnect(),this.wifiStatus=!1,this.tag("Networks").visible=!1,this.tag("Switch.Button").src=c.asset("images/switch-off.png"))}))})):this._wifi.setInterface("WIFI",!0).then((t=>{t.success&&this._wifi.setDefaultInterface("WIFI",!1).then((t=>{t.success&&this._wifi.setEnabled(!0).then((t=>{t.success&&(this.wifiStatus=!0,this.tag("Networks").visible=!0,this.tag("Switch.Button").src=c.asset("images/switch-on.png"),this._wifi.discoverSSIDs(),this.tag("Networks.AvailableNetworks.Loader").visible=!0)}))}))}))}_activateWiFi(){this._wifi.activate().then((()=>{this._wifi.getDefaultInterface().then((t=>{"WIFI"==t.interface&&this.switch()}))})),this.tag("Networks.AvailableNetworks.Loader").visible=!0,this._wifi.registerEvent("onWIFIStateChanged",(t=>{2!==t.state&&5!==t.state||(this._wifi.discoverSSIDs(),this.tag("Networks.AvailableNetworks.Loader").visible=!0),this._setState("Switch")})),this._wifi.registerEvent("onError",(t=>{this._wifi.discoverSSIDs(),this.tag("Networks.AvailableNetworks.Loader").visible=!0,4==t.code&&(this.patch({FailureMessage:{x:1320,y:950,text:{text:"INCORRECT PASSWORD"}}}),setTimeout((()=>{this.childList.remove(this.tag("FailureMessage"))}),2e3)),this._setState("Switch")})),this._wifi.registerEvent("onAvailableSSIDs",(t=>{this.tag("Networks.AvailableNetworks.Loader").visible=!1,this.renderDeviceList(t.ssids)}))}}class SettingsScreen extends g.Component{static _template(){return{Background:{w:1920,h:1080,src:c.asset("images/tvShows/background.jpg")},Sidebar:{x:1280,y:0,w:640,h:1080,rect:!0,color:4281747025},WiFiScreen:{type:WiFiScreen,visible:!1},BluetoothScreen:{type:BluetoothScreen,visible:!1}}}_enable(){this._appAnimation=this.animation({duration:.3,repeat:0,stopMethod:"immediate",actions:[{p:"alpha",v:{0:.5,1:1}},{p:"y",v:{0:1080,1:0}}]}),this._appAnimation.start()}_disable(){this._appAnimation=this.animation({duration:.3,repeat:0,stopMethod:"immediate",actions:[{p:"alpha",v:{0:.5,1:1}},{p:"y",v:{0:0,1:1080}}]}),this._appAnimation.start()}set screen(t){this._setState(t)}set params(t){null!=t.animation&&t.animation.start()}static _states(){return[class BluetoothScreen extends(this){$enter(){this.tag("BluetoothScreen").visible=!0}_getFocused(){return this.tag("BluetoothScreen")}$exit(){this.tag("BluetoothScreen").visible=!1}_handleKey(t){(77==t.keyCode||49==t.keyCode||36==t.keyCode||158==t.keyCode||73==t.keyCode&&1==t.ctrlKey)&&(this._appAnimation=this.animation({duration:.5,repeat:0,stopMethod:"immediate",actions:[{p:"alpha",v:{0:.5,1:1}},{p:"y",v:{0:0,1:1080}}]}),this._appAnimation.start(),this._appAnimation.on("finish",(t=>{lt("home")})))}},class WiFiScreen extends(this){$enter(){this.tag("WiFiScreen").visible=!0}_getFocused(){return this.tag("WiFiScreen")}$exit(){this.tag("WiFiScreen").visible=!1}_handleKey(t){(77==t.keyCode||49==t.keyCode||36==t.keyCode||158==t.keyCode||73==t.keyCode&&1==t.ctrlKey)&&(this._appAnimation=this.animation({duration:.3,repeat:0,stopMethod:"immediate",actions:[{p:"alpha",v:{0:.5,1:1}},{p:"y",v:{0:0,1:1080}}]}),this._appAnimation.start(),this._appAnimation.on("finish",(t=>{lt("home")})))}}]}}class Error$1 extends g.Component{static _template(){return{rect:!0,w:1920,h:1080,color:4290184710,Label:{x:100,y:100,text:{text:"Error",fontSize:22}}}}_handleEnter(){lt("home")}_focus(){console.log("focus error page")}set error(t){const{page:e,error:i}=t;console.log(e,i);const s=`\nerror while loading page: ${e.constructor.name}\npress enter to navigate to home\n--\nloaded via hash: ${e[Symbol.for("hash")]}\nresulted in route: ${e[Symbol.for("route")]}\n--\n${i.toString()}`;this.tag("Label").text=s}pageTransition(){return"up"}}var Zt={root:"home",routes:[{path:"home",component:HomeScreen,before:()=>(console.log("before home!"),Promise.resolve()),cache:10},{path:"settings/:screen",options:{preventStorage:!0,clearHistory:!0,reuseInstance:!0},component:SettingsScreen,cache:10},{path:"splash",component:SplashScreen,options:{preventStorage:!0,clearHistory:!0,reuseInstance:!1},cache:10},{path:"!",component:Error$1},{path:"*",component:HomeScreen}]};class App extends ht{static getFonts(){return[{family:"Regular",url:c.asset("fonts/Roboto-Regular.ttf")}]}_setup(){Router_startRouter(Zt,this),document.onkeydown=t=>{8==t.keyCode&&t.preventDefault()}}}return function index(){return Launch(App,...arguments)}}();
//# sourceMappingURL=appBundle.js.map
